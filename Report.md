
# Artificial Intelligence Nanodegree

## Convolutional Neural Networks

## Project: Write an Algorithm for a Dog Identification App 

---

In this notebook, some template code has already been provided for you, and you will need to implement additional functionality to successfully complete this project. You will not need to modify the included code beyond what is requested. Sections that begin with **'(IMPLEMENTATION)'** in the header indicate that the following block of code will require additional functionality which you must provide. Instructions will be provided for each section, and the specifics of the implementation are marked in the code block with a 'TODO' statement. Please be sure to read the instructions carefully! 

> **Note**: Once you have completed all of the code implementations, you need to finalize your work by exporting the iPython Notebook as an HTML document. Before exporting the notebook to html, all of the code cells need to have been run so that reviewers can see the final implementation and output. You can then export the notebook by using the menu above and navigating to  \n",
    "**File -> Download as -> HTML (.html)**. Include the finished document along with this notebook as your submission.

In addition to implementing code, there will be questions that you must answer which relate to the project and your implementation. Each section where you will answer a question is preceded by a **'Question X'** header. Carefully read each question and provide thorough answers in the following text boxes that begin with **'Answer:'**. Your project submission will be evaluated based on your answers to each of the questions and the implementation you provide.

>**Note:** Code and Markdown cells can be executed using the **Shift + Enter** keyboard shortcut.  Markdown cells can be edited by double-clicking the cell to enter edit mode.

The rubric contains _optional_ "Stand Out Suggestions" for enhancing the project beyond the minimum requirements. If you decide to pursue the "Stand Out Suggestions", you should include the code in this IPython notebook.



---
### Why We're Here 

In this notebook, you will make the first steps towards developing an algorithm that could be used as part of a mobile or web app.  At the end of this project, your code will accept any user-supplied image as input.  If a dog is detected in the image, it will provide an estimate of the dog's breed.  If a human is detected, it will provide an estimate of the dog breed that is most resembling.  The image below displays potential sample output of your finished project (... but we expect that each student's algorithm will behave differently!). 

![Sample Dog Output](images/sample_dog_output.png)

In this real-world setting, you will need to piece together a series of models to perform different tasks; for instance, the algorithm that detects humans in an image will be different from the CNN that infers dog breed.  There are many points of possible failure, and no perfect algorithm exists.  Your imperfect solution will nonetheless create a fun user experience!

### The Road Ahead

We break the notebook into separate steps.  Feel free to use the links below to navigate the notebook.

* [Step 0](#step0): Import Datasets
* [Step 1](#step1): Detect Humans
* [Step 2](#step2): Detect Dogs
* [Step 3](#step3): Create a CNN to Classify Dog Breeds (from Scratch)
* [Step 4](#step4): Use a CNN to Classify Dog Breeds (using Transfer Learning)
* [Step 5](#step5): Create a CNN to Classify Dog Breeds (using Transfer Learning)
* [Step 6](#step6): Write your Algorithm
* [Step 7](#step7): Test Your Algorithm

---
<a id='step0'></a>
## Step 0: Import Datasets

### Import Dog Dataset

In the code cell below, we import a dataset of dog images.  We populate a few variables through the use of the `load_files` function from the scikit-learn library:
- `train_files`, `valid_files`, `test_files` - numpy arrays containing file paths to images
- `train_targets`, `valid_targets`, `test_targets` - numpy arrays containing onehot-encoded classification labels 
- `dog_names` - list of string-valued dog breed names for translating labels


```python
from sklearn.datasets import load_files       
from keras.utils import np_utils
import numpy as np
from glob import glob

# define function to load train, test, and validation datasets
def load_dataset(path):
    data = load_files(path)
    dog_files = np.array(data['filenames'])
    dog_targets = np_utils.to_categorical(np.array(data['target']), 133)
    return dog_files, dog_targets

# load train, test, and validation datasets
train_files, train_targets = load_dataset('dogImages/train')
valid_files, valid_targets = load_dataset('dogImages/valid')
test_files, test_targets = load_dataset('dogImages/test')

# load list of dog names
dog_names = [item[20:-1] for item in sorted(glob("dogImages/train/*/"))]

# print statistics about the dataset
print('There are %d total dog categories.' % len(dog_names))
print('There are %s total dog images.\n' % len(np.hstack([train_files, valid_files, test_files])))
print('There are %d training dog images.' % len(train_files))
print('There are %d validation dog images.' % len(valid_files))
print('There are %d test dog images.'% len(test_files))
```

    Using TensorFlow backend.


    There are 133 total dog categories.
    There are 8351 total dog images.
    
    There are 6680 training dog images.
    There are 835 validation dog images.
    There are 836 test dog images.


### Import Human Dataset

In the code cell below, we import a dataset of human images, where the file paths are stored in the numpy array `human_files`.


```python
import random
random.seed(8675309)

# load filenames in shuffled human dataset
human_files = np.array(glob("lfw/*/*"))
random.shuffle(human_files)

# print statistics about the dataset
print('There are %d total human images.' % len(human_files))
```

    There are 13233 total human images.


---
<a id='step1'></a>
## Step 1: Detect Humans

We use OpenCV's implementation of [Haar feature-based cascade classifiers](http://docs.opencv.org/trunk/d7/d8b/tutorial_py_face_detection.html) to detect human faces in images.  OpenCV provides many pre-trained face detectors, stored as XML files on [github](https://github.com/opencv/opencv/tree/master/data/haarcascades).  We have downloaded one of these detectors and stored it in the `haarcascades` directory.

In the next code cell, we demonstrate how to use this detector to find human faces in a sample image.


```python
import cv2                
import matplotlib.pyplot as plt                        
%matplotlib inline                               

# extract pre-trained face detector
face_cascade = cv2.CascadeClassifier('haarcascades/haarcascade_frontalface_alt.xml')

# load color (BGR) image
img = cv2.imread(human_files[3])
# convert BGR image to grayscale
gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

# find faces in image
faces = face_cascade.detectMultiScale(gray)

# print number of faces detected in the image
print('Number of faces detected:', len(faces))

# get bounding box for each detected face
for (x,y,w,h) in faces:
    # add bounding box to color image
    cv2.rectangle(img,(x,y),(x+w,y+h),(255,0,0),2)
    
# convert BGR image to RGB for plotting
cv_rgb = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

# display the image, along with bounding box
plt.imshow(cv_rgb)
plt.show()
```

    Number of faces detected: 1



![png](output_5_1.png)


Before using any of the face detectors, it is standard procedure to convert the images to grayscale.  The `detectMultiScale` function executes the classifier stored in `face_cascade` and takes the grayscale image as a parameter.  

In the above code, `faces` is a numpy array of detected faces, where each row corresponds to a detected face.  Each detected face is a 1D array with four entries that specifies the bounding box of the detected face.  The first two entries in the array (extracted in the above code as `x` and `y`) specify the horizontal and vertical positions of the top left corner of the bounding box.  The last two entries in the array (extracted here as `w` and `h`) specify the width and height of the box.

### Write a Human Face Detector

We can use this procedure to write a function that returns `True` if a human face is detected in an image and `False` otherwise.  This function, aptly named `face_detector`, takes a string-valued file path to an image as input and appears in the code block below.


```python
# returns "True" if face is detected in image stored at img_path
def face_detector(img_path):
    img = cv2.imread(img_path)
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
    faces = face_cascade.detectMultiScale(gray)
    return len(faces) > 0
```

### (IMPLEMENTATION) Assess the Human Face Detector

__Question 1:__ Use the code cell below to test the performance of the `face_detector` function.  
- What percentage of the first 100 images in `human_files` have a detected human face?  
- What percentage of the first 100 images in `dog_files` have a detected human face? 

Ideally, we would like 100% of human images with a detected face and 0% of dog images with a detected face.  You will see that our algorithm falls short of this goal, but still gives acceptable performance.  We extract the file paths for the first 100 images from each of the datasets and store them in the numpy arrays `human_files_short` and `dog_files_short`.

__Answer:__ 


```python
human_files_short = human_files[:100]
dog_files_short = train_files[:100]
# Do NOT modify the code above this line.

## Test the performance of the face_detector algorithm 
## on the images in human_files_short and dog_files_short.
human_detected = [h for h in human_files_short if face_detector(h)]
h_pc = len(human_detected) * 1.
print("Human percentage: {}%".format(h_pc))
dog_detected = [d for d in dog_files_short if face_detector(d)]
d_pc = len(dog_detected) * 1.
print("Dog percentage: {}%".format(d_pc))
```

    Human percentage: 100.0%
    Dog percentage: 11.0%


__Question 2:__ This algorithmic choice necessitates that we communicate to the user that we accept human images only when they provide a clear view of a face (otherwise, we risk having unneccessarily frustrated users!). In your opinion, is this a reasonable expectation to pose on the user? If not, can you think of a way to detect humans in images that does not necessitate an image with a clearly presented face?

__Answer:__

We suggest the face detector from OpenCV as a potential way to detect human images in your algorithm, but you are free to explore other approaches, especially approaches that make use of deep learning :).  Please use the code cell below to design and test your own face detection algorithm.  If you decide to pursue this _optional_ task, report performance on each of the datasets.


```python
## Report the performance of another  
## face detection algorithm on the LFW dataset
### Feel free to use as many code cells as needed.
from keras.layers import Conv2D, MaxPooling2D, GlobalAveragePooling2D, Activation
from keras.layers import Dropout, Flatten, Dense
from keras.models import Sequential
from keras.callbacks import ModelCheckpoint

def resize_image(img_path):
    img = cv2.imread(img_path)
    return cv2.resize(img, (224, 224))

humans_X = [resize_image(i) for i in human_files]
dogs_X = [resize_image(i) for i in train_files]
```


```python
humans_X_short = humans_X[:200]
dogs_X_short = dogs_X[:200]

humans_y = []
for x in humans_X_short:
    humans_y.append([1, 0])
    
humans_y = np.array(humans_y, dtype=np.float32)

dogs_y = []
for x in dogs_X_short:
    dogs_y.append([0, 1])
dogs_y = np.array(dogs_y, dtype=np.float32)

dvh_X = np.concatenate((humans_X_short, dogs_X_short), axis=0)
dvh_y = np.concatenate((humans_y, dogs_y), axis=0)
```


```python
model = Sequential()
model.add(Conv2D(filters=16, kernel_size=(7, 7), input_shape=(224, 224, 3)))
model.add(Activation("relu"))
model.add(MaxPooling2D(pool_size=(2, 2), strides=(2,2), padding='same'))
model.add(Conv2D(filters=32, kernel_size=(5, 5)))
model.add(Activation("relu"))
model.add(MaxPooling2D(pool_size=(2, 2), strides=(1,1), padding='same'))
model.add(GlobalAveragePooling2D())
model.add(Dropout(0.2))
model.add(Dense(120))
model.add(Activation("relu"))
model.add(Dense(2))
model.add(Activation("softmax"))
model.summary()

model.compile(optimizer='rmsprop', loss='categorical_crossentropy', metrics=['accuracy'])

epochs = 200

checkpointer = ModelCheckpoint(filepath='saved_models/weights.best.dogs_vs_humans.hdf5', 
                               verbose=1, save_best_only=True)

model.fit(dvh_X, dvh_y,
          epochs=epochs, batch_size=20, callbacks=[checkpointer], verbose=1)
```

    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    conv2d_3 (Conv2D)            (None, 218, 218, 16)      2368      
    _________________________________________________________________
    activation_5 (Activation)    (None, 218, 218, 16)      0         
    _________________________________________________________________
    max_pooling2d_3 (MaxPooling2 (None, 109, 109, 16)      0         
    _________________________________________________________________
    conv2d_4 (Conv2D)            (None, 105, 105, 32)      12832     
    _________________________________________________________________
    activation_6 (Activation)    (None, 105, 105, 32)      0         
    _________________________________________________________________
    max_pooling2d_4 (MaxPooling2 (None, 105, 105, 32)      0         
    _________________________________________________________________
    global_average_pooling2d_2 ( (None, 32)                0         
    _________________________________________________________________
    dropout_2 (Dropout)          (None, 32)                0         
    _________________________________________________________________
    dense_3 (Dense)              (None, 120)               3960      
    _________________________________________________________________
    activation_7 (Activation)    (None, 120)               0         
    _________________________________________________________________
    dense_4 (Dense)              (None, 2)                 242       
    _________________________________________________________________
    activation_8 (Activation)    (None, 2)                 0         
    =================================================================
    Total params: 19,402.0
    Trainable params: 19,402.0
    Non-trainable params: 0.0
    _________________________________________________________________
    Epoch 1/200
    400/400 [==============================] - 20s - loss: 8.0387 - acc: 0.4975     

    /Users/RumzAvi/anaconda3/envs/dog-project/lib/python3.5/site-packages/keras/callbacks.py:388: RuntimeWarning: Can save best model only with val_loss available, skipping.
      'skipping.' % (self.monitor), RuntimeWarning)


    
    Epoch 2/200
    400/400 [==============================] - 21s - loss: 8.0590 - acc: 0.5000     
    Epoch 3/200
    400/400 [==============================] - 21s - loss: 8.0590 - acc: 0.5000     
    Epoch 4/200
    400/400 [==============================] - 21s - loss: 8.0590 - acc: 0.5000     
    Epoch 5/200
    400/400 [==============================] - 22s - loss: 8.0590 - acc: 0.5000      
    Epoch 6/200
    400/400 [==============================] - 21s - loss: 7.7345 - acc: 0.5175     
    Epoch 7/200
    400/400 [==============================] - 21s - loss: 8.0590 - acc: 0.5000     
    Epoch 8/200
    400/400 [==============================] - 21s - loss: 8.0590 - acc: 0.5000      
    Epoch 9/200
    400/400 [==============================] - 21s - loss: 8.0590 - acc: 0.5000     
    Epoch 10/200
    400/400 [==============================] - 21s - loss: 8.0590 - acc: 0.5000     
    Epoch 11/200
    400/400 [==============================] - 21s - loss: 8.0461 - acc: 0.5000     
    Epoch 12/200
    400/400 [==============================] - 21s - loss: 7.7845 - acc: 0.5075     
    Epoch 13/200
    400/400 [==============================] - 21s - loss: 5.3084 - acc: 0.5100     
    Epoch 14/200
    400/400 [==============================] - 21s - loss: 0.7641 - acc: 0.6700     
    Epoch 15/200
    400/400 [==============================] - 21s - loss: 0.7434 - acc: 0.6600     
    Epoch 16/200
    400/400 [==============================] - 21s - loss: 0.6681 - acc: 0.7150     
    Epoch 17/200
    400/400 [==============================] - 21s - loss: 0.4775 - acc: 0.7950     
    Epoch 18/200
    400/400 [==============================] - 22s - loss: 0.4701 - acc: 0.7750     
    Epoch 19/200
    400/400 [==============================] - 22s - loss: 0.6268 - acc: 0.8275     
    Epoch 20/200
    400/400 [==============================] - 23s - loss: 0.6332 - acc: 0.7350     
    Epoch 21/200
    400/400 [==============================] - 21s - loss: 0.4796 - acc: 0.8150     
    Epoch 22/200
    400/400 [==============================] - 22s - loss: 0.4149 - acc: 0.8275     
    Epoch 23/200
    400/400 [==============================] - 21s - loss: 0.6354 - acc: 0.8100     
    Epoch 24/200
    400/400 [==============================] - 21s - loss: 0.4939 - acc: 0.8575     
    Epoch 25/200
    400/400 [==============================] - 22s - loss: 0.4309 - acc: 0.8525     
    Epoch 26/200
    400/400 [==============================] - 21s - loss: 0.3457 - acc: 0.8350     
    Epoch 27/200
    400/400 [==============================] - 21s - loss: 0.6244 - acc: 0.7875     
    Epoch 28/200
    400/400 [==============================] - 21s - loss: 0.4848 - acc: 0.8350     
    Epoch 29/200
    400/400 [==============================] - 21s - loss: 0.3114 - acc: 0.8800     
    Epoch 30/200
    400/400 [==============================] - 21s - loss: 0.3298 - acc: 0.8550     
    Epoch 31/200
    400/400 [==============================] - 21s - loss: 0.3382 - acc: 0.8750     
    Epoch 32/200
    400/400 [==============================] - 21s - loss: 0.4430 - acc: 0.8250     
    Epoch 33/200
    400/400 [==============================] - 21s - loss: 0.2909 - acc: 0.8900     
    Epoch 34/200
    400/400 [==============================] - 21s - loss: 3.7345 - acc: 0.7075     
    Epoch 35/200
    400/400 [==============================] - 21s - loss: 0.4761 - acc: 0.8450     
    Epoch 36/200
    400/400 [==============================] - 21s - loss: 0.4544 - acc: 0.8750     
    Epoch 37/200
    400/400 [==============================] - 21s - loss: 0.2420 - acc: 0.9050     
    Epoch 38/200
    400/400 [==============================] - 21s - loss: 0.3441 - acc: 0.8600     
    Epoch 39/200
    400/400 [==============================] - 21s - loss: 0.1984 - acc: 0.9250     
    Epoch 40/200
    400/400 [==============================] - 21s - loss: 0.8501 - acc: 0.8425     
    Epoch 41/200
    400/400 [==============================] - 21s - loss: 0.4332 - acc: 0.8750     
    Epoch 42/200
    400/400 [==============================] - 21s - loss: 0.2252 - acc: 0.9000     
    Epoch 43/200
    400/400 [==============================] - 21s - loss: 0.2702 - acc: 0.8825     
    Epoch 44/200
    400/400 [==============================] - 21s - loss: 0.2689 - acc: 0.9025     
    Epoch 45/200
    400/400 [==============================] - 21s - loss: 0.2549 - acc: 0.9000     
    Epoch 46/200
    400/400 [==============================] - 21s - loss: 0.1755 - acc: 0.9250     
    Epoch 47/200
    400/400 [==============================] - 21s - loss: 0.2451 - acc: 0.8925     
    Epoch 48/200
    400/400 [==============================] - 21s - loss: 0.6620 - acc: 0.8625     
    Epoch 49/200
    400/400 [==============================] - 21s - loss: 0.2092 - acc: 0.9150     
    Epoch 50/200
    400/400 [==============================] - 21s - loss: 0.2013 - acc: 0.9075     
    Epoch 51/200
    400/400 [==============================] - 21s - loss: 0.1727 - acc: 0.9450     
    Epoch 52/200
    400/400 [==============================] - 21s - loss: 0.1702 - acc: 0.9275     
    Epoch 53/200
    400/400 [==============================] - 21s - loss: 0.3781 - acc: 0.9050     
    Epoch 54/200
    400/400 [==============================] - 21s - loss: 0.2785 - acc: 0.8875     
    Epoch 55/200
    400/400 [==============================] - 21s - loss: 0.8521 - acc: 0.8475     
    Epoch 56/200
    400/400 [==============================] - 21s - loss: 0.1811 - acc: 0.9275     
    Epoch 57/200
    400/400 [==============================] - 21s - loss: 0.6040 - acc: 0.9050     
    Epoch 58/200
    400/400 [==============================] - 22s - loss: 0.2578 - acc: 0.9050     
    Epoch 59/200
    400/400 [==============================] - 22s - loss: 0.1960 - acc: 0.9325     
    Epoch 60/200
    400/400 [==============================] - 21s - loss: 0.2944 - acc: 0.9125     
    Epoch 61/200
    400/400 [==============================] - 21s - loss: 0.6416 - acc: 0.9025     
    Epoch 62/200
    400/400 [==============================] - 21s - loss: 0.1908 - acc: 0.9350     
    Epoch 63/200
    400/400 [==============================] - 21s - loss: 0.2653 - acc: 0.9225     
    Epoch 64/200
    400/400 [==============================] - 21s - loss: 0.2010 - acc: 0.9325     
    Epoch 65/200
    400/400 [==============================] - 21s - loss: 0.1983 - acc: 0.9275     
    Epoch 66/200
    400/400 [==============================] - 21s - loss: 0.2022 - acc: 0.9250     
    Epoch 67/200
    400/400 [==============================] - 21s - loss: 0.1771 - acc: 0.9500     
    Epoch 68/200
    400/400 [==============================] - 21s - loss: 0.3207 - acc: 0.8900     
    Epoch 69/200
    400/400 [==============================] - 21s - loss: 0.2085 - acc: 0.9350     
    Epoch 70/200
    400/400 [==============================] - 21s - loss: 0.1816 - acc: 0.9500     
    Epoch 71/200
    400/400 [==============================] - 21s - loss: 0.4120 - acc: 0.8975     
    Epoch 72/200
    400/400 [==============================] - 21s - loss: 0.1603 - acc: 0.9425     
    Epoch 73/200
    400/400 [==============================] - 22s - loss: 0.0881 - acc: 0.9650     
    Epoch 74/200
    400/400 [==============================] - 22s - loss: 0.3116 - acc: 0.9250     
    Epoch 75/200
    400/400 [==============================] - 22s - loss: 0.1641 - acc: 0.9400     
    Epoch 76/200
    400/400 [==============================] - 21s - loss: 0.1549 - acc: 0.9525     
    Epoch 77/200
    400/400 [==============================] - 21s - loss: 0.3180 - acc: 0.9100     
    Epoch 78/200
    400/400 [==============================] - 21s - loss: 0.1435 - acc: 0.9550     
    Epoch 79/200
    400/400 [==============================] - 21s - loss: 0.1199 - acc: 0.9425     
    Epoch 80/200
    400/400 [==============================] - 22s - loss: 0.2081 - acc: 0.9450     
    Epoch 81/200
    400/400 [==============================] - 22s - loss: 0.1987 - acc: 0.9475     
    Epoch 82/200
    400/400 [==============================] - 21s - loss: 0.1263 - acc: 0.9500     
    Epoch 83/200
    400/400 [==============================] - 22s - loss: 0.2679 - acc: 0.9250     
    Epoch 84/200
    400/400 [==============================] - 22s - loss: 0.1162 - acc: 0.9325     
    Epoch 85/200
    400/400 [==============================] - 22s - loss: 0.1080 - acc: 0.9675     
    Epoch 86/200
    400/400 [==============================] - 22s - loss: 0.2517 - acc: 0.9300     
    Epoch 87/200
    400/400 [==============================] - 22s - loss: 0.2715 - acc: 0.9350     
    Epoch 88/200
    400/400 [==============================] - 22s - loss: 0.1874 - acc: 0.9500     
    Epoch 89/200
    400/400 [==============================] - 22s - loss: 0.1181 - acc: 0.9625     
    Epoch 90/200
    400/400 [==============================] - 22s - loss: 0.1250 - acc: 0.9450     
    Epoch 91/200
    400/400 [==============================] - 22s - loss: 0.3048 - acc: 0.9500     
    Epoch 92/200
    400/400 [==============================] - 22s - loss: 0.0645 - acc: 0.9750     
    Epoch 93/200
    400/400 [==============================] - 22s - loss: 0.1447 - acc: 0.9450     
    Epoch 94/200
    400/400 [==============================] - 22s - loss: 0.2084 - acc: 0.9450     
    Epoch 95/200
    400/400 [==============================] - 22s - loss: 0.4541 - acc: 0.9500     
    Epoch 96/200
    400/400 [==============================] - 22s - loss: 0.0798 - acc: 0.9700     
    Epoch 97/200
    400/400 [==============================] - 22s - loss: 0.1495 - acc: 0.9550     
    Epoch 98/200
    400/400 [==============================] - 22s - loss: 0.4931 - acc: 0.9325     
    Epoch 99/200
    400/400 [==============================] - 22s - loss: 0.1922 - acc: 0.9450     
    Epoch 100/200
    400/400 [==============================] - 22s - loss: 0.4331 - acc: 0.9650     
    Epoch 101/200
    400/400 [==============================] - 22s - loss: 0.1929 - acc: 0.9375     
    Epoch 102/200
    400/400 [==============================] - 22s - loss: 0.1418 - acc: 0.9525     
    Epoch 103/200
    400/400 [==============================] - 22s - loss: 0.1427 - acc: 0.9550     
    Epoch 104/200
    400/400 [==============================] - 22s - loss: 0.1232 - acc: 0.9650     
    Epoch 105/200
    400/400 [==============================] - 22s - loss: 0.4484 - acc: 0.9350     
    Epoch 106/200
    400/400 [==============================] - 22s - loss: 0.0649 - acc: 0.9725     
    Epoch 107/200
    400/400 [==============================] - 22s - loss: 0.3533 - acc: 0.9350     
    Epoch 108/200
    400/400 [==============================] - 22s - loss: 0.1866 - acc: 0.9325     
    Epoch 109/200
    400/400 [==============================] - 22s - loss: 0.1990 - acc: 0.9525     
    Epoch 110/200
    400/400 [==============================] - 22s - loss: 0.0597 - acc: 0.9825     
    Epoch 111/200
    400/400 [==============================] - 22s - loss: 0.4649 - acc: 0.9250     
    Epoch 112/200
    400/400 [==============================] - 22s - loss: 0.0678 - acc: 0.9775     
    Epoch 113/200
    400/400 [==============================] - 22s - loss: 0.6063 - acc: 0.9425     
    Epoch 114/200
    400/400 [==============================] - 22s - loss: 0.3305 - acc: 0.9400     
    Epoch 115/200
    400/400 [==============================] - 22s - loss: 0.1018 - acc: 0.9500     
    Epoch 116/200
    400/400 [==============================] - 22s - loss: 1.4116 - acc: 0.8825     
    Epoch 117/200
    400/400 [==============================] - 22s - loss: 0.0528 - acc: 0.9850     
    Epoch 118/200
    400/400 [==============================] - 22s - loss: 0.1140 - acc: 0.9575         
    Epoch 119/200
    400/400 [==============================] - 22s - loss: 0.0529 - acc: 0.9775     
    Epoch 120/200
    400/400 [==============================] - 22s - loss: 0.3984 - acc: 0.9500     
    Epoch 121/200
    400/400 [==============================] - 22s - loss: 0.0492 - acc: 0.9800     
    Epoch 122/200
    400/400 [==============================] - 22s - loss: 0.1970 - acc: 0.9500     
    Epoch 123/200
    400/400 [==============================] - 22s - loss: 0.0577 - acc: 0.9775     
    Epoch 124/200
    400/400 [==============================] - 22s - loss: 0.4115 - acc: 0.9375     
    Epoch 125/200
    400/400 [==============================] - 22s - loss: 0.1127 - acc: 0.9675     
    Epoch 126/200
    400/400 [==============================] - 22s - loss: 0.3571 - acc: 0.9575     
    Epoch 127/200
    400/400 [==============================] - 22s - loss: 0.0750 - acc: 0.9775     
    Epoch 128/200
    400/400 [==============================] - 22s - loss: 0.0619 - acc: 0.9750     
    Epoch 129/200
    400/400 [==============================] - 22s - loss: 0.0549 - acc: 0.9750     
    Epoch 130/200
    400/400 [==============================] - 22s - loss: 0.1940 - acc: 0.9400     
    Epoch 131/200
    400/400 [==============================] - 22s - loss: 0.1380 - acc: 0.9675     
    Epoch 132/200
    400/400 [==============================] - 22s - loss: 0.0622 - acc: 0.9850     
    Epoch 133/200
    400/400 [==============================] - 22s - loss: 0.2338 - acc: 0.9550     
    Epoch 134/200
    400/400 [==============================] - 22s - loss: 0.0476 - acc: 0.9850     
    Epoch 135/200
    400/400 [==============================] - 22s - loss: 0.1187 - acc: 0.9650     
    Epoch 136/200
    400/400 [==============================] - 22s - loss: 0.1049 - acc: 0.9675     
    Epoch 137/200
    400/400 [==============================] - 22s - loss: 0.0453 - acc: 0.9800     
    Epoch 138/200
    400/400 [==============================] - 22s - loss: 0.4117 - acc: 0.9475     
    Epoch 139/200
    400/400 [==============================] - 22s - loss: 0.3357 - acc: 0.9550     
    Epoch 140/200
    400/400 [==============================] - 22s - loss: 0.0357 - acc: 0.9850     
    Epoch 141/200
    400/400 [==============================] - 22s - loss: 0.1116 - acc: 0.9550     
    Epoch 142/200
    400/400 [==============================] - 22s - loss: 0.3961 - acc: 0.9300     
    Epoch 143/200
    400/400 [==============================] - 22s - loss: 0.0494 - acc: 0.9825     
    Epoch 144/200
    400/400 [==============================] - 22s - loss: 0.2970 - acc: 0.9700     
    Epoch 145/200
    400/400 [==============================] - 22s - loss: 0.2045 - acc: 0.9625     
    Epoch 146/200
    400/400 [==============================] - 22s - loss: 0.1638 - acc: 0.9675     
    Epoch 147/200
    400/400 [==============================] - 22s - loss: 0.1455 - acc: 0.9700     
    Epoch 148/200
    400/400 [==============================] - 22s - loss: 0.3255 - acc: 0.9275     
    Epoch 149/200
    400/400 [==============================] - 22s - loss: 0.0426 - acc: 0.9925     
    Epoch 150/200
    400/400 [==============================] - 22s - loss: 0.0957 - acc: 0.9625         
    Epoch 151/200
    400/400 [==============================] - 22s - loss: 0.1966 - acc: 0.9600     
    Epoch 152/200
    400/400 [==============================] - 22s - loss: 0.3668 - acc: 0.9500     
    Epoch 153/200
    400/400 [==============================] - 22s - loss: 0.1116 - acc: 0.9650     
    Epoch 154/200
    400/400 [==============================] - 22s - loss: 0.0513 - acc: 0.9775     
    Epoch 155/200
    400/400 [==============================] - 22s - loss: 0.0755 - acc: 0.9750     
    Epoch 156/200
    400/400 [==============================] - 22s - loss: 0.1511 - acc: 0.9625     
    Epoch 157/200
    400/400 [==============================] - 22s - loss: 0.1389 - acc: 0.9750     
    Epoch 158/200
    400/400 [==============================] - 22s - loss: 0.0425 - acc: 0.9850     
    Epoch 159/200
    400/400 [==============================] - 22s - loss: 0.1677 - acc: 0.9625     
    Epoch 160/200
    400/400 [==============================] - 22s - loss: 0.1241 - acc: 0.9675     
    Epoch 161/200
    400/400 [==============================] - 22s - loss: 0.0377 - acc: 0.9850     
    Epoch 162/200
    400/400 [==============================] - 22s - loss: 0.1446 - acc: 0.9675     
    Epoch 163/200
    400/400 [==============================] - 22s - loss: 0.0216 - acc: 0.9950     
    Epoch 164/200
    400/400 [==============================] - 22s - loss: 0.1372 - acc: 0.9675     
    Epoch 165/200
    400/400 [==============================] - 22s - loss: 0.0528 - acc: 0.9800     
    Epoch 166/200
    400/400 [==============================] - 22s - loss: 0.2540 - acc: 0.9450     
    Epoch 167/200
    400/400 [==============================] - 22s - loss: 0.0369 - acc: 0.9875     
    Epoch 168/200
    400/400 [==============================] - 22s - loss: 0.0319 - acc: 0.9875     
    Epoch 169/200
    400/400 [==============================] - 22s - loss: 0.0817 - acc: 0.9825     
    Epoch 170/200
    400/400 [==============================] - 22s - loss: 0.0240 - acc: 0.9950     
    Epoch 171/200
    400/400 [==============================] - 22s - loss: 0.0338 - acc: 0.9875     
    Epoch 172/200
    400/400 [==============================] - 22s - loss: 0.2556 - acc: 0.9625     
    Epoch 173/200
    400/400 [==============================] - 22s - loss: 0.1115 - acc: 0.9775         
    Epoch 174/200
    400/400 [==============================] - 22s - loss: 0.0638 - acc: 0.9725     
    Epoch 175/200
    400/400 [==============================] - 22s - loss: 0.0220 - acc: 0.9900         
    Epoch 176/200
    400/400 [==============================] - 22s - loss: 0.0944 - acc: 0.9700         
    Epoch 177/200
    400/400 [==============================] - 22s - loss: 0.0884 - acc: 0.9725     
    Epoch 178/200
    400/400 [==============================] - 22s - loss: 0.1387 - acc: 0.9700     
    Epoch 179/200
    400/400 [==============================] - 22s - loss: 0.1986 - acc: 0.9525     
    Epoch 180/200
    400/400 [==============================] - 22s - loss: 0.0291 - acc: 0.9875     
    Epoch 181/200
    400/400 [==============================] - 22s - loss: 0.0939 - acc: 0.9850     
    Epoch 182/200
    400/400 [==============================] - 22s - loss: 0.1709 - acc: 0.9750     
    Epoch 183/200
    400/400 [==============================] - 22s - loss: 0.0478 - acc: 0.9850     
    Epoch 184/200
    400/400 [==============================] - 22s - loss: 0.0397 - acc: 0.9825     
    Epoch 185/200
    400/400 [==============================] - 25s - loss: 0.6866 - acc: 0.9400     
    Epoch 186/200
    400/400 [==============================] - 1223s - loss: 0.1605 - acc: 0.9775    
    Epoch 187/200
    400/400 [==============================] - 20s - loss: 0.0693 - acc: 0.9750     
    Epoch 188/200
    400/400 [==============================] - 923s - loss: 0.0842 - acc: 0.9775     
    Epoch 189/200
    400/400 [==============================] - 24s - loss: 0.0681 - acc: 0.9800     
    Epoch 190/200
    400/400 [==============================] - 22s - loss: 0.0419 - acc: 0.9800     
    Epoch 191/200
    400/400 [==============================] - 22s - loss: 0.0456 - acc: 0.9925     
    Epoch 192/200
    400/400 [==============================] - 22s - loss: 0.0150 - acc: 0.9975     
    Epoch 193/200
    400/400 [==============================] - 22s - loss: 0.1763 - acc: 0.9750     
    Epoch 194/200
    400/400 [==============================] - 22s - loss: 0.1997 - acc: 0.9650     
    Epoch 195/200
    400/400 [==============================] - 22s - loss: 0.1017 - acc: 0.9725         
    Epoch 196/200
    400/400 [==============================] - 22s - loss: 0.0500 - acc: 0.9850     
    Epoch 197/200
    400/400 [==============================] - 22s - loss: 0.0325 - acc: 0.9850     
    Epoch 198/200
    400/400 [==============================] - 22s - loss: 0.1149 - acc: 0.9800     
    Epoch 199/200
    400/400 [==============================] - 22s - loss: 0.1463 - acc: 0.9675     
    Epoch 200/200
    400/400 [==============================] - 22s - loss: 0.0631 - acc: 0.9850     





    <keras.callbacks.History at 0x177f50ef0>




```python
model.save_weights("saved_models/weights.best.dogs_vs_humans.hdf5")
```


```python
humans_X_test = humans_X[100:200]
dogs_X_test = dogs_X[100:200]

my_X_test = np.concatenate((humans_X_test, dogs_X_test), axis=0)

my_predictions = [np.argmax(model.predict(np.expand_dims(t, axis=0))) for t in my_X_test]

dvh_test = []
for i in range(0, 100):
    dvh_test.append(0)

for i in range(0, 100):
    dvh_test.append(1)

# report test accuracy
my_test_accuracy = 100*np.sum(np.array(my_predictions)==np.array(dvh_test))/len(my_predictions)
print('Test accuracy: %.4f%%' % my_test_accuracy)
```

    Test accuracy: 84.0000%


A clearly presented face is not an acceptable in real-life scenarios like pictures could be blurred or skewed or picture could be in any angle. By using haar-cascades, we could add other xml cascade files that are also account for profile or skewed views, or even create your own, OpenCV has a train-cascade facility for that. 

However, this process is time consuming and not nearly as accurate as constructing a deep learning network. In the above case, the deep neural network with a couple of groups of CONV-RELU-POOL layers, a POOL layer to gather the best features and flatten the data, then two FC layers and with a softmax activation for the final classification. The example above is a POC which run over 200 images dataset (100 humans and 100 dogs) and over only 200 epochs. 

It took about 1Hr 40mins to complete the training. Looks like most of the time, it was getting mistaken human faces for dog faces.


---
<a id='step2'></a>
## Step 2: Detect Dogs

In this section, we use a pre-trained [ResNet-50](http://ethereon.github.io/netscope/#/gist/db945b393d40bfa26006) model to detect dogs in images.  Our first line of code downloads the ResNet-50 model, along with weights that have been trained on [ImageNet](http://www.image-net.org/), a very large, very popular dataset used for image classification and other vision tasks.  ImageNet contains over 10 million URLs, each linking to an image containing an object from one of [1000 categories](https://gist.github.com/yrevar/942d3a0ac09ec9e5eb3a).  Given an image, this pre-trained ResNet-50 model returns a prediction (derived from the available categories in ImageNet) for the object that is contained in the image.


```python
from keras.applications.resnet50 import ResNet50

# define ResNet50 model
ResNet50_model = ResNet50(weights='imagenet')
```

    Downloading data from https://github.com/fchollet/deep-learning-models/releases/download/v0.2/resnet50_weights_tf_dim_ordering_tf_kernels.h5


### Pre-process the Data

When using TensorFlow as backend, Keras CNNs require a 4D array (which we'll also refer to as a 4D tensor) as input, with shape

$$
(\text{nb_samples}, \text{rows}, \text{columns}, \text{channels}),
$$

where `nb_samples` corresponds to the total number of images (or samples), and `rows`, `columns`, and `channels` correspond to the number of rows, columns, and channels for each image, respectively.  

The `path_to_tensor` function below takes a string-valued file path to a color image as input and returns a 4D tensor suitable for supplying to a Keras CNN.  The function first loads the image and resizes it to a square image that is $224 \times 224$ pixels.  Next, the image is converted to an array, which is then resized to a 4D tensor.  In this case, since we are working with color images, each image has three channels.  Likewise, since we are processing a single image (or sample), the returned tensor will always have shape

$$
(1, 224, 224, 3).
$$

The `paths_to_tensor` function takes a numpy array of string-valued image paths as input and returns a 4D tensor with shape 

$$
(\text{nb_samples}, 224, 224, 3).
$$

Here, `nb_samples` is the number of samples, or number of images, in the supplied array of image paths.  It is best to think of `nb_samples` as the number of 3D tensors (where each 3D tensor corresponds to a different image) in your dataset!


```python
from keras.preprocessing import image                  
from tqdm import tqdm

def path_to_tensor(img_path):
    # loads RGB image as PIL.Image.Image type
    img = image.load_img(img_path, target_size=(224, 224))
    # convert PIL.Image.Image type to 3D tensor with shape (224, 224, 3)
    x = image.img_to_array(img)
    # convert 3D tensor to 4D tensor with shape (1, 224, 224, 3) and return 4D tensor
    return np.expand_dims(x, axis=0)

def paths_to_tensor(img_paths):
    list_of_tensors = [path_to_tensor(img_path) for img_path in tqdm(img_paths)]
    return np.vstack(list_of_tensors)
```

### Making Predictions with ResNet-50

Getting the 4D tensor ready for ResNet-50, and for any other pre-trained model in Keras, requires some additional processing.  First, the RGB image is converted to BGR by reordering the channels.  All pre-trained models have the additional normalization step that the mean pixel (expressed in RGB as $[103.939, 116.779, 123.68]$ and calculated from all pixels in all images in ImageNet) must be subtracted from every pixel in each image.  This is implemented in the imported function `preprocess_input`.  If you're curious, you can check the code for `preprocess_input` [here](https://github.com/fchollet/keras/blob/master/keras/applications/imagenet_utils.py).

Now that we have a way to format our image for supplying to ResNet-50, we are now ready to use the model to extract the predictions.  This is accomplished with the `predict` method, which returns an array whose $i$-th entry is the model's predicted probability that the image belongs to the $i$-th ImageNet category.  This is implemented in the `ResNet50_predict_labels` function below.

By taking the argmax of the predicted probability vector, we obtain an integer corresponding to the model's predicted object class, which we can identify with an object category through the use of this [dictionary](https://gist.github.com/yrevar/942d3a0ac09ec9e5eb3a). 


```python
from keras.applications.resnet50 import preprocess_input, decode_predictions

def ResNet50_predict_labels(img_path):
    # returns prediction vector for image located at img_path
    img = preprocess_input(path_to_tensor(img_path))
    return np.argmax(ResNet50_model.predict(img))
```

### Write a Dog Detector

While looking at the [dictionary](https://gist.github.com/yrevar/942d3a0ac09ec9e5eb3a), you will notice that the categories corresponding to dogs appear in an uninterrupted sequence and correspond to dictionary keys 151-268, inclusive, to include all categories from `'Chihuahua'` to `'Mexican hairless'`.  Thus, in order to check to see if an image is predicted to contain a dog by the pre-trained ResNet-50 model, we need only check if the `ResNet50_predict_labels` function above returns a value between 151 and 268 (inclusive).

We use these ideas to complete the `dog_detector` function below, which returns `True` if a dog is detected in an image (and `False` if not).


```python
### returns "True" if a dog is detected in the image stored at img_path
def dog_detector(img_path):
    prediction = ResNet50_predict_labels(img_path)
    return ((prediction <= 268) & (prediction >= 151)) 
```

### (IMPLEMENTATION) Assess the Dog Detector

__Question 3:__ Use the code cell below to test the performance of your `dog_detector` function.  
- What percentage of the images in `human_files_short` have a detected dog?  
- What percentage of the images in `dog_files_short` have a detected dog?

__Answer:__ 


```python
### The performance of the dog_detector function
### on the images in human_files_short and dog_files_short.
h_pc = len([h for h in human_files_short if dog_detector(h)])
d_pc = len([d for d in dog_files_short if dog_detector(d)])
print("Humans: {}%, dogs: {}%".format(h_pc * 1., d_pc * 1.))
```

    Humans: 0.0%, dogs: 100.0%


---
<a id='step3'></a>
## Step 3: Create a CNN to Classify Dog Breeds (from Scratch)

Now that we have functions for detecting humans and dogs in images, we need a way to predict breed from images.  In this step, you will create a CNN that classifies dog breeds.  You must create your CNN _from scratch_ (so, you can't use transfer learning _yet_!), and you must attain a test accuracy of at least 1%.  In Step 5 of this notebook, you will have the opportunity to use transfer learning to create a CNN that attains greatly improved accuracy.

Be careful with adding too many trainable layers!  More parameters means longer training, which means you are more likely to need a GPU to accelerate the training process.  Thankfully, Keras provides a handy estimate of the time that each epoch is likely to take; you can extrapolate this estimate to figure out how long it will take for your algorithm to train. 

We mention that the task of assigning breed to dogs from images is considered exceptionally challenging.  To see why, consider that *even a human* would have great difficulty in distinguishing between a Brittany and a Welsh Springer Spaniel.  

Brittany | Welsh Springer Spaniel
- | - 
<img src="images/Brittany_02625.jpg" width="100"> | <img src="images/Welsh_springer_spaniel_08203.jpg" width="200">

It is not difficult to find other dog breed pairs with minimal inter-class variation (for instance, Curly-Coated Retrievers and American Water Spaniels).  

Curly-Coated Retriever | American Water Spaniel
- | -
<img src="images/Curly-coated_retriever_03896.jpg" width="200"> | <img src="images/American_water_spaniel_00648.jpg" width="200">


Likewise, recall that labradors come in yellow, chocolate, and black.  Your vision-based algorithm will have to conquer this high intra-class variation to determine how to classify all of these different shades as the same breed.  

Yellow Labrador | Chocolate Labrador | Black Labrador
- | -
<img src="images/Labrador_retriever_06457.jpg" width="150"> | <img src="images/Labrador_retriever_06455.jpg" width="240"> | <img src="images/Labrador_retriever_06449.jpg" width="220">

We also mention that random chance presents an exceptionally low bar: setting aside the fact that the classes are slightly imabalanced, a random guess will provide a correct answer roughly 1 in 133 times, which corresponds to an accuracy of less than 1%.  

Remember that the practice is far ahead of the theory in deep learning.  Experiment with many different architectures, and trust your intuition.  And, of course, have fun! 

### Pre-process the Data

We rescale the images by dividing every pixel in every image by 255.


```python
from PIL import ImageFile                            
ImageFile.LOAD_TRUNCATED_IMAGES = True                 

# pre-process the data for Keras
train_tensors = paths_to_tensor(train_files).astype('float32')/255
valid_tensors = paths_to_tensor(valid_files).astype('float32')/255
test_tensors = paths_to_tensor(test_files).astype('float32')/255
```

    100%|██████████| 6680/6680 [01:59<00:00, 55.80it/s]
    100%|██████████| 835/835 [00:13<00:00, 61.42it/s]
    100%|██████████| 836/836 [00:13<00:00, 62.02it/s]


### (IMPLEMENTATION) Model Architecture

Create a CNN to classify dog breed.  At the end of your code cell block, summarize the layers of your model by executing the line:
    
        model.summary()

We have imported some Python modules to get you started, but feel free to import as many modules as you need.  If you end up getting stuck, here's a hint that specifies a model that trains relatively fast on CPU and attains >1% test accuracy in 5 epochs:

![Sample CNN](images/sample_cnn.png)
           
__Question 4:__ Outline the steps you took to get to your final CNN architecture and your reasoning at each step.  If you chose to use the hinted architecture above, describe why you think that CNN architecture should work well for the image classification task.

__Answer:__ 

In the past I have read about well-known DL architectures, for example LeNet and AlexNet. They yielded satisfactory results especially considering they are relatively shallow architectures. 

Architecture mentioned below combines the suggested architecture with a sort of LeNet architecture, where the Flattening happens through the GlobalAveragePooling layer, I think, it would be more effective than a simple Flatten() as the features in the GAP level represent a feature.

In first two CONV layers, I have increased the filters as suggested by the lectures, but I have decreased the kernel size as the tensor size after a CONV-POOL layer which reduces in height and width but it increases in depth. Then it fed those values coming from the GAP into two consecutive FC layers. This enables the use of at least one "relu" activation layer in a FC layer, this is very effective. Ideally I would keep the three 
CONV-POOL sets of layers, but I sacrificed one of them for the sake of some training speed. If I had more time, I would have added the GAP + Dropout + FC + FC into the originally suggested architecture, which will result in a slower epoch pass but increases the accuracy.


```python
from keras.layers import Conv2D, MaxPooling2D, GlobalAveragePooling2D
from keras.layers import Dropout, Flatten, Dense
from keras.models import Sequential

model = Sequential()

### Model architecture.
model.add(Conv2D(filters=32, kernel_size=(9,9), input_shape=(224, 224, 3)))
model.add(Activation("relu"))
model.add(MaxPooling2D(pool_size=(2, 2), strides=(2,2), padding='same'))
model.add(Conv2D(filters=64, kernel_size=(7,7)))
model.add(Activation("relu"))
model.add(MaxPooling2D(pool_size=(2, 2), strides=(1,1), padding='same'))
model.add(GlobalAveragePooling2D())
model.add(Dropout(0.1))
model.add(Dense(500))
model.add(Activation("relu"))
model.add(Dense(133))
model.add(Activation("softmax"))
model.summary()
```

    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    conv2d_5 (Conv2D)            (None, 216, 216, 32)      7808      
    _________________________________________________________________
    activation_58 (Activation)   (None, 216, 216, 32)      0         
    _________________________________________________________________
    max_pooling2d_6 (MaxPooling2 (None, 108, 108, 32)      0         
    _________________________________________________________________
    conv2d_6 (Conv2D)            (None, 102, 102, 64)      100416    
    _________________________________________________________________
    activation_59 (Activation)   (None, 102, 102, 64)      0         
    _________________________________________________________________
    max_pooling2d_7 (MaxPooling2 (None, 102, 102, 64)      0         
    _________________________________________________________________
    global_average_pooling2d_3 ( (None, 64)                0         
    _________________________________________________________________
    dropout_3 (Dropout)          (None, 64)                0         
    _________________________________________________________________
    dense_5 (Dense)              (None, 500)               32500     
    _________________________________________________________________
    activation_60 (Activation)   (None, 500)               0         
    _________________________________________________________________
    dense_6 (Dense)              (None, 133)               66633     
    _________________________________________________________________
    activation_61 (Activation)   (None, 133)               0         
    =================================================================
    Total params: 207,357.0
    Trainable params: 207,357.0
    Non-trainable params: 0.0
    _________________________________________________________________


### Compile the Model


```python
model.compile(optimizer='rmsprop', loss='categorical_crossentropy', metrics=['accuracy'])
```

### (IMPLEMENTATION) Train the Model

Train your model in the code cell below.  Use model checkpointing to save the model that attains the best validation loss.

You are welcome to [augment the training data](https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html), but this is not a requirement. 


```python
from keras.callbacks import ModelCheckpoint  

### TODO: specify the number of epochs that you would like to use to train the model.

epochs = 10

### Do NOT modify the code below this line.

checkpointer = ModelCheckpoint(filepath='saved_models/weights.best.from_scratch.hdf5', 
                               verbose=1, save_best_only=True)

model.fit(train_tensors, train_targets, 
          validation_data=(valid_tensors, valid_targets),
          epochs=epochs, batch_size=20, callbacks=[checkpointer], verbose=1)
```

    Train on 6680 samples, validate on 835 samples
    Epoch 1/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.8885 - acc: 0.0089       Epoch 00000: val_loss improved from inf to 4.86982, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1108s - loss: 4.8886 - acc: 0.0088 - val_loss: 4.8698 - val_acc: 0.0156
    Epoch 2/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.8663 - acc: 0.0125       Epoch 00001: val_loss did not improve
    6680/6680 [==============================] - 1146s - loss: 4.8658 - acc: 0.0124 - val_loss: 4.8974 - val_acc: 0.0144
    Epoch 3/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.8068 - acc: 0.0168   Epoch 00002: val_loss improved from 4.86982 to 4.77650, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1142s - loss: 4.8070 - acc: 0.0168 - val_loss: 4.7765 - val_acc: 0.0204
    Epoch 4/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.7759 - acc: 0.0177       Epoch 00003: val_loss improved from 4.77650 to 4.75098, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1103s - loss: 4.7755 - acc: 0.0178 - val_loss: 4.7510 - val_acc: 0.0228
    Epoch 5/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.7528 - acc: 0.0221   Epoch 00004: val_loss improved from 4.75098 to 4.73692, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1105s - loss: 4.7528 - acc: 0.0220 - val_loss: 4.7369 - val_acc: 0.0180
    Epoch 6/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.7099 - acc: 0.0213       Epoch 00005: val_loss improved from 4.73692 to 4.69585, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1106s - loss: 4.7101 - acc: 0.0214 - val_loss: 4.6959 - val_acc: 0.0335
    Epoch 7/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.6581 - acc: 0.0294   Epoch 00006: val_loss improved from 4.69585 to 4.68141, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1131s - loss: 4.6585 - acc: 0.0293 - val_loss: 4.6814 - val_acc: 0.0311
    Epoch 8/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.6059 - acc: 0.0303   Epoch 00007: val_loss improved from 4.68141 to 4.62602, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1122s - loss: 4.6064 - acc: 0.0304 - val_loss: 4.6260 - val_acc: 0.0323
    Epoch 9/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.5433 - acc: 0.0371       Epoch 00008: val_loss improved from 4.62602 to 4.56936, saving model to saved_models/weights.best.from_scratch.hdf5
    6680/6680 [==============================] - 1128s - loss: 4.5429 - acc: 0.0370 - val_loss: 4.5694 - val_acc: 0.0407
    Epoch 10/10
    6660/6680 [============================>.] - ETA: 3s - loss: 4.4881 - acc: 0.0437   Epoch 00009: val_loss did not improve
    6680/6680 [==============================] - 1226s - loss: 4.4868 - acc: 0.0437 - val_loss: 4.5987 - val_acc: 0.0383





    <keras.callbacks.History at 0x17c451eb8>



### Load the Model with the Best Validation Loss


```python
model.load_weights('saved_models/weights.best.from_scratch.hdf5')
```

### Test the Model

Try out your model on the test dataset of dog images.  Ensure that your test accuracy is greater than 1%.


```python
# get index of predicted dog breed for each image in test set
dog_breed_predictions = [np.argmax(model.predict(np.expand_dims(tensor, axis=0))) for tensor in test_tensors]

# report test accuracy
test_accuracy = 100*np.sum(np.array(dog_breed_predictions)==np.argmax(test_targets, axis=1))/len(dog_breed_predictions)
print('Test accuracy: %.4f%%' % test_accuracy)
```

    Test accuracy: 4.3062%


---
<a id='step4'></a>
## Step 4: Use a CNN to Classify Dog Breeds

To reduce training time without sacrificing accuracy, we show you how to train a CNN using transfer learning.  In the following step, you will get a chance to use transfer learning to train your own CNN.

### Obtain Bottleneck Features


```python
bottleneck_features = np.load('bottleneck_features/DogVGG16Data.npz')
train_VGG16 = bottleneck_features['train']
valid_VGG16 = bottleneck_features['valid']
test_VGG16 = bottleneck_features['test']
```

### Model Architecture

The model uses the the pre-trained VGG-16 model as a fixed feature extractor, where the last convolutional output of VGG-16 is fed as input to our model.  We only add a global average pooling layer and a fully connected layer, where the latter contains one node for each dog category and is equipped with a softmax.


```python
VGG16_model = Sequential()
VGG16_model.add(GlobalAveragePooling2D(input_shape=train_VGG16.shape[1:]))
VGG16_model.add(Dense(133, activation='softmax'))

VGG16_model.summary()
```

    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    global_average_pooling2d_4 ( (None, 512)               0         
    _________________________________________________________________
    dense_7 (Dense)              (None, 133)               68229     
    =================================================================
    Total params: 68,229.0
    Trainable params: 68,229.0
    Non-trainable params: 0.0
    _________________________________________________________________


### Compile the Model


```python
VGG16_model.compile(loss='categorical_crossentropy', optimizer='rmsprop', metrics=['accuracy'])
```

### Train the Model


```python
checkpointer = ModelCheckpoint(filepath='saved_models/weights.best.VGG16.hdf5', 
                               verbose=1, save_best_only=True)

VGG16_model.fit(train_VGG16, train_targets, 
          validation_data=(valid_VGG16, valid_targets),
          epochs=20, batch_size=20, callbacks=[checkpointer], verbose=1)
```

    Train on 6680 samples, validate on 835 samples
    Epoch 1/20
    6280/6680 [===========================>..] - ETA: 0s - loss: 12.4000 - acc: 0.1067      Epoch 00000: val_loss improved from inf to 10.57723, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 12.2994 - acc: 0.1129 - val_loss: 10.5772 - val_acc: 0.2156
    Epoch 2/20
    6400/6680 [===========================>..] - ETA: 0s - loss: 9.7886 - acc: 0.2972 Epoch 00001: val_loss improved from 10.57723 to 9.84870, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 0s - loss: 9.7703 - acc: 0.2993 - val_loss: 9.8487 - val_acc: 0.2802
    Epoch 3/20
    6360/6680 [===========================>..] - ETA: 0s - loss: 9.3197 - acc: 0.3577 Epoch 00002: val_loss improved from 9.84870 to 9.64261, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 0s - loss: 9.2863 - acc: 0.3605 - val_loss: 9.6426 - val_acc: 0.3317
    Epoch 4/20
    6380/6680 [===========================>..] - ETA: 0s - loss: 9.1026 - acc: 0.3898 Epoch 00003: val_loss improved from 9.64261 to 9.55440, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 0s - loss: 9.0704 - acc: 0.3916 - val_loss: 9.5544 - val_acc: 0.3281
    Epoch 5/20
    6360/6680 [===========================>..] - ETA: 0s - loss: 8.9118 - acc: 0.4126Epoch 00004: val_loss improved from 9.55440 to 9.40956, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 8.8944 - acc: 0.4130 - val_loss: 9.4096 - val_acc: 0.3353
    Epoch 6/20
    6300/6680 [===========================>..] - ETA: 0s - loss: 8.8086 - acc: 0.4268 Epoch 00005: val_loss improved from 9.40956 to 9.37475, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 8.7931 - acc: 0.4284 - val_loss: 9.3748 - val_acc: 0.3425
    Epoch 7/20
    6560/6680 [============================>.] - ETA: 0s - loss: 8.6553 - acc: 0.4383 Epoch 00006: val_loss improved from 9.37475 to 9.32727, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 0s - loss: 8.6699 - acc: 0.4374 - val_loss: 9.3273 - val_acc: 0.3449
    Epoch 8/20
    6600/6680 [============================>.] - ETA: 0s - loss: 8.5653 - acc: 0.4497Epoch 00007: val_loss improved from 9.32727 to 9.15011, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 8.5600 - acc: 0.4501 - val_loss: 9.1501 - val_acc: 0.3533
    Epoch 9/20
    6620/6680 [============================>.] - ETA: 0s - loss: 8.4332 - acc: 0.4583Epoch 00008: val_loss improved from 9.15011 to 9.06396, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 8.4540 - acc: 0.4572 - val_loss: 9.0640 - val_acc: 0.3617
    Epoch 10/20
    6640/6680 [============================>.] - ETA: 0s - loss: 8.4013 - acc: 0.4669 Epoch 00009: val_loss improved from 9.06396 to 8.97502, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 8.3968 - acc: 0.4672 - val_loss: 8.9750 - val_acc: 0.3784
    Epoch 11/20
    6340/6680 [===========================>..] - ETA: 0s - loss: 8.3640 - acc: 0.4724Epoch 00010: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 8.3684 - acc: 0.4725 - val_loss: 8.9881 - val_acc: 0.3844
    Epoch 12/20
    6520/6680 [============================>.] - ETA: 0s - loss: 8.3563 - acc: 0.4724Epoch 00011: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 8.3281 - acc: 0.4741 - val_loss: 9.0300 - val_acc: 0.3689
    Epoch 13/20
    6340/6680 [===========================>..] - ETA: 0s - loss: 8.2420 - acc: 0.4784Epoch 00012: val_loss improved from 8.97502 to 8.91655, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 8.2276 - acc: 0.4792 - val_loss: 8.9165 - val_acc: 0.3737
    Epoch 14/20
    6320/6680 [===========================>..] - ETA: 0s - loss: 8.1704 - acc: 0.4829Epoch 00013: val_loss improved from 8.91655 to 8.81690, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 0s - loss: 8.1397 - acc: 0.4844 - val_loss: 8.8169 - val_acc: 0.3808
    Epoch 15/20
    6380/6680 [===========================>..] - ETA: 0s - loss: 7.8586 - acc: 0.4953Epoch 00014: val_loss improved from 8.81690 to 8.61569, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 7.8881 - acc: 0.4933 - val_loss: 8.6157 - val_acc: 0.3820
    Epoch 16/20
    6380/6680 [===========================>..] - ETA: 0s - loss: 7.7366 - acc: 0.5089Epoch 00015: val_loss improved from 8.61569 to 8.46554, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 7.7344 - acc: 0.5090 - val_loss: 8.4655 - val_acc: 0.4036
    Epoch 17/20
    6380/6680 [===========================>..] - ETA: 0s - loss: 7.6566 - acc: 0.5197Epoch 00016: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 7.7033 - acc: 0.5168 - val_loss: 8.4997 - val_acc: 0.4132
    Epoch 18/20
    6420/6680 [===========================>..] - ETA: 0s - loss: 7.7069 - acc: 0.5167Epoch 00017: val_loss improved from 8.46554 to 8.43196, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 7.6786 - acc: 0.5178 - val_loss: 8.4320 - val_acc: 0.4168
    Epoch 19/20
    6580/6680 [============================>.] - ETA: 0s - loss: 7.5981 - acc: 0.5207Epoch 00018: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 7.6059 - acc: 0.5201 - val_loss: 8.4351 - val_acc: 0.4048
    Epoch 20/20
    6480/6680 [============================>.] - ETA: 0s - loss: 7.5499 - acc: 0.5252Epoch 00019: val_loss improved from 8.43196 to 8.39335, saving model to saved_models/weights.best.VGG16.hdf5
    6680/6680 [==============================] - 1s - loss: 7.5443 - acc: 0.5254 - val_loss: 8.3934 - val_acc: 0.4048





    <keras.callbacks.History at 0x17c01cf98>



### Load the Model with the Best Validation Loss


```python
VGG16_model.load_weights('saved_models/weights.best.VGG16.hdf5')
```

### Test the Model

Now, we can use the CNN to test how well it identifies breed within our test dataset of dog images.  We print the test accuracy below.


```python
# get index of predicted dog breed for each image in test set
VGG16_predictions = [np.argmax(VGG16_model.predict(np.expand_dims(feature, axis=0))) for feature in test_VGG16]

# report test accuracy
test_accuracy = 100*np.sum(np.array(VGG16_predictions)==np.argmax(test_targets, axis=1))/len(VGG16_predictions)
print('Test accuracy: %.4f%%' % test_accuracy)
```

    Test accuracy: 42.5837%


### Predict Dog Breed with the Model


```python
from extract_bottleneck_features import *

def VGG16_predict_breed(img_path):
    # extract bottleneck features
    bottleneck_feature = extract_VGG16(path_to_tensor(img_path))
    # obtain predicted vector
    predicted_vector = VGG16_model.predict(bottleneck_feature)
    # return dog breed that is predicted by the model
    return dog_names[np.argmax(predicted_vector)]
```

---
<a id='step5'></a>
## Step 5: Create a CNN to Classify Dog Breeds (using Transfer Learning)

You will now use transfer learning to create a CNN that can identify dog breed from images.  Your CNN must attain at least 60% accuracy on the test set.

In Step 4, we used transfer learning to create a CNN using VGG-16 bottleneck features.  In this section, you must use the bottleneck features from a different pre-trained model.  To make things easier for you, we have pre-computed the features for all of the networks that are currently available in Keras:
- [VGG-19](https://s3-us-west-1.amazonaws.com/udacity-aind/dog-project/DogVGG19Data.npz) bottleneck features
- [ResNet-50](https://s3-us-west-1.amazonaws.com/udacity-aind/dog-project/DogResnet50Data.npz) bottleneck features
- [Inception](https://s3-us-west-1.amazonaws.com/udacity-aind/dog-project/DogInceptionV3Data.npz) bottleneck features
- [Xception](https://s3-us-west-1.amazonaws.com/udacity-aind/dog-project/DogXceptionData.npz) bottleneck features

The files are encoded as such:

    Dog{network}Data.npz
    
where `{network}`, in the above filename, can be one of `VGG19`, `Resnet50`, `InceptionV3`, or `Xception`.  Pick one of the above architectures, download the corresponding bottleneck features, and store the downloaded file in the `bottleneck_features/` folder in the repository.

### (IMPLEMENTATION) Obtain Bottleneck Features

In the code block below, extract the bottleneck features corresponding to the train, test, and validation sets by running the following:

    bottleneck_features = np.load('bottleneck_features/Dog{network}Data.npz')
    train_{network} = bottleneck_features['train']
    valid_{network} = bottleneck_features['valid']
    test_{network} = bottleneck_features['test']


```python
### Obtain bottleneck features from another pre-trained CNN.
bottleneck_features = np.load('bottleneck_features/DogVGG16Data.npz')
train_Inception = bottleneck_features['train']
valid_Inception = bottleneck_features['valid']
test_Inception = bottleneck_features['test']
```

### (IMPLEMENTATION) Model Architecture

Create a CNN to classify dog breed.  At the end of your code cell block, summarize the layers of your model by executing the line:
    
        <your model's name>.summary()
   
__Question 5:__ Outline the steps you took to get to your final CNN architecture and your reasoning at each step.  Describe why you think the architecture is suitable for the current problem.

__Answer:__ 




The architecture of my network is defined as follows: a first GAP layer to extract the best features from the images
as processed by the VGG bottleneck features, which is then fed into a 500-nodes FC layer activated with tanh and a final 133-nodes FC layer with softmax for final classification.
I applied a 20% dropout probability before the final FC layer.

Reasoning
The original architecture applies numerous CONV and POOL filters, which made me think there was no more 
need for further convolutions to be applied in my network.
By adding more CONV-POOL layers would have decreased the performance of the training to an impractical level, and also I did not see enough improvements in loss and accuracy when I tried. So, when I took a look of my architecture, thats where I realized that I am doing something wrong.

So, I tried to squeeze the best features processed through VGG weights, and fed them into a non-linear neural network. I find a GAP layer ideal for the job for two purposes: 1. it retrieves the best features from an image processed through VGG weights, and 2. it flattens the data as a bonus. From there, as I was facing a non-linear problem, I needed at least another 2 FC layers. My reasoning for choosing tanh over relu or sigmoid is pure empirical, after a few tries, I found that tanh was performing better than other activation functions in this particular case. I added a dropout layer to improve accuracy. Again, empirically I found 0.2 to be the best value, with 0.1 not making too great a difference, while anything bigger than 0.2 worsening the model even significantly. 


```python
### Architecture.
Inc_model = Sequential()
Inc_model.add(GlobalAveragePooling2D(input_shape=train_Inception.shape[1:]))
Inc_model.add(Dense(500))
Inc_model.add(Activation("tanh"))
Inc_model.add(Dropout(0.2))
Inc_model.add(Dense(133, activation='softmax'))
Inc_model.summary()
```

    _________________________________________________________________
    Layer (type)                 Output Shape              Param #   
    =================================================================
    global_average_pooling2d_5 ( (None, 512)               0         
    _________________________________________________________________
    dense_8 (Dense)              (None, 500)               256500    
    _________________________________________________________________
    activation_62 (Activation)   (None, 500)               0         
    _________________________________________________________________
    dropout_4 (Dropout)          (None, 500)               0         
    _________________________________________________________________
    dense_9 (Dense)              (None, 133)               66633     
    =================================================================
    Total params: 323,133.0
    Trainable params: 323,133.0
    Non-trainable params: 0.0
    _________________________________________________________________


### (IMPLEMENTATION) Compile the Model


```python
### Compile the model.
Inc_model.compile(optimizer='rmsprop', loss='categorical_crossentropy', metrics=['accuracy'])
```

### (IMPLEMENTATION) Train the Model

Train your model in the code cell below.  Use model checkpointing to save the model that attains the best validation loss.  

You are welcome to [augment the training data](https://blog.keras.io/building-powerful-image-classification-models-using-very-little-data.html), but this is not a requirement. 


```python
### Train the model.
checkpointer = ModelCheckpoint(filepath='saved_models/weights.best.Inc_model.hdf5', 
                               verbose=1, save_best_only=True)

Inc_model.fit(train_Inception, train_targets, 
          validation_data=(valid_Inception, valid_targets),
          epochs=2000, batch_size=20, callbacks=[checkpointer], verbose=1)
```

    Train on 6680 samples, validate on 835 samples
    Epoch 1/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00000: val_loss improved from inf to 2.28309, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2831 - val_acc: 0.7713
    Epoch 2/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00001: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4114 - val_acc: 0.7737
    Epoch 3/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00002: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3318 - val_acc: 0.7701
    Epoch 4/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00003: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3176 - val_acc: 0.7760
    Epoch 5/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00004: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3308 - val_acc: 0.7784
    Epoch 6/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00005: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4109 - val_acc: 0.7653
    Epoch 7/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00006: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4090 - val_acc: 0.7533
    Epoch 8/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00007: val_loss improved from 2.28309 to 2.25948, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2595 - val_acc: 0.7689
    Epoch 9/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00008: val_loss improved from 2.25948 to 2.24937, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2494 - val_acc: 0.7701
    Epoch 10/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0086 - acc: 0.9994    Epoch 00009: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0132 - acc: 0.9991 - val_loss: 2.3119 - val_acc: 0.7617
    Epoch 11/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00010: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2977 - val_acc: 0.7617
    Epoch 12/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00011: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2746 - val_acc: 0.7713
    Epoch 13/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0140 - acc: 0.9991    Epoch 00012: val_loss improved from 2.24937 to 2.24901, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0138 - acc: 0.9991 - val_loss: 2.2490 - val_acc: 0.7689
    Epoch 14/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00013: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3165 - val_acc: 0.7713
    Epoch 15/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00014: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3133 - val_acc: 0.7796
    Epoch 16/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00015: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2986 - val_acc: 0.7713
    Epoch 17/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0126 - acc: 0.9991    Epoch 00016: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9991 - val_loss: 2.2901 - val_acc: 0.7796
    Epoch 18/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00017: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3168 - val_acc: 0.7713
    Epoch 19/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0095 - acc: 0.9994    Epoch 00018: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0116 - acc: 0.9993 - val_loss: 2.2846 - val_acc: 0.7701
    Epoch 20/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00019: val_loss improved from 2.24901 to 2.24436, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2444 - val_acc: 0.7725
    Epoch 21/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00020: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3249 - val_acc: 0.7701
    Epoch 22/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00021: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3291 - val_acc: 0.7760
    Epoch 23/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0127 - acc: 0.9991    Epoch 00022: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0125 - acc: 0.9991 - val_loss: 2.3276 - val_acc: 0.7689
    Epoch 24/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0102 - acc: 0.9992    Epoch 00023: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9991 - val_loss: 2.3721 - val_acc: 0.7629
    Epoch 25/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00024: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3546 - val_acc: 0.7677
    Epoch 26/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00025: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3613 - val_acc: 0.7701
    Epoch 27/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00026: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3324 - val_acc: 0.7796
    Epoch 28/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00027: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2870 - val_acc: 0.7784
    Epoch 29/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00028: val_loss improved from 2.24436 to 2.23465, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2346 - val_acc: 0.7677
    Epoch 30/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00029: val_loss improved from 2.23465 to 2.21296, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2130 - val_acc: 0.7737
    Epoch 31/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00030: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2427 - val_acc: 0.7760
    Epoch 32/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00031: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2842 - val_acc: 0.7749
    Epoch 33/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00032: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2324 - val_acc: 0.7749
    Epoch 34/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0137 - acc: 0.9991    Epoch 00033: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0134 - acc: 0.9991 - val_loss: 2.2458 - val_acc: 0.7725
    Epoch 35/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00034: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2873 - val_acc: 0.7737
    Epoch 36/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0111 - acc: 0.9992    Epoch 00035: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0108 - acc: 0.9993 - val_loss: 2.2291 - val_acc: 0.7904
    Epoch 37/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00036: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0125 - acc: 0.9991 - val_loss: 2.2242 - val_acc: 0.7760
    Epoch 38/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9991    Epoch 00037: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9991 - val_loss: 2.3102 - val_acc: 0.7725
    Epoch 39/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00038: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2713 - val_acc: 0.7784
    Epoch 40/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00039: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3367 - val_acc: 0.7784
    Epoch 41/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00040: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3254 - val_acc: 0.7784
    Epoch 42/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00041: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3153 - val_acc: 0.7701
    Epoch 43/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00042: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3083 - val_acc: 0.7856
    Epoch 44/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00043: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2974 - val_acc: 0.7808
    Epoch 45/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00044: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2405 - val_acc: 0.7832
    Epoch 46/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0127 - acc: 0.9991    Epoch 00045: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.3096 - val_acc: 0.7725
    Epoch 47/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00046: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0120 - acc: 0.9993 - val_loss: 2.3377 - val_acc: 0.7737
    Epoch 48/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9991    Epoch 00047: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0118 - acc: 0.9991 - val_loss: 2.2985 - val_acc: 0.7844
    Epoch 49/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00048: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3666 - val_acc: 0.7737
    Epoch 50/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0137 - acc: 0.9991    Epoch 00049: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.3271 - val_acc: 0.7701
    Epoch 51/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0103 - acc: 0.9992    Epoch 00050: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0123 - acc: 0.9991 - val_loss: 2.3105 - val_acc: 0.7665
    Epoch 52/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0077 - acc: 0.9994    Epoch 00051: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0099 - acc: 0.9993 - val_loss: 2.3653 - val_acc: 0.7701
    Epoch 53/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00052: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2777 - val_acc: 0.7832
    Epoch 54/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00053: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3782 - val_acc: 0.7725
    Epoch 55/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00054: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3775 - val_acc: 0.7725
    Epoch 56/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00055: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3475 - val_acc: 0.7772
    Epoch 57/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00056: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3527 - val_acc: 0.7749
    Epoch 58/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00057: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4130 - val_acc: 0.7677
    Epoch 59/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00058: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4208 - val_acc: 0.7665
    Epoch 60/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00059: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4211 - val_acc: 0.7713
    Epoch 61/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0130 - acc: 0.9991    Epoch 00060: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.3622 - val_acc: 0.7713
    Epoch 62/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00061: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3025 - val_acc: 0.7737
    Epoch 63/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00062: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2869 - val_acc: 0.7701
    Epoch 64/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00063: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3413 - val_acc: 0.7760
    Epoch 65/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00064: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3315 - val_acc: 0.7737
    Epoch 66/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00065: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2857 - val_acc: 0.7796
    Epoch 67/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00066: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3695 - val_acc: 0.7820
    Epoch 68/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00067: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4055 - val_acc: 0.7856
    Epoch 69/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00068: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3431 - val_acc: 0.7796
    Epoch 70/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00069: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4232 - val_acc: 0.7725
    Epoch 71/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00070: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3938 - val_acc: 0.7749
    Epoch 72/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0149 - acc: 0.9991    Epoch 00071: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0143 - acc: 0.9991 - val_loss: 2.3771 - val_acc: 0.7677
    Epoch 73/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00072: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.3273 - val_acc: 0.7772
    Epoch 74/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9992    Epoch 00073: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0115 - acc: 0.9993 - val_loss: 2.3776 - val_acc: 0.7701
    Epoch 75/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00074: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3686 - val_acc: 0.7689
    Epoch 76/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00075: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3423 - val_acc: 0.7880
    Epoch 77/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00076: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3509 - val_acc: 0.7760
    Epoch 78/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00077: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.5287 - val_acc: 0.7641
    Epoch 79/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00078: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4421 - val_acc: 0.7689
    Epoch 80/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00079: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4138 - val_acc: 0.7701
    Epoch 81/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00080: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3572 - val_acc: 0.7808
    Epoch 82/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00081: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3612 - val_acc: 0.7796
    Epoch 83/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0144 - acc: 0.9991    Epoch 00082: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0142 - acc: 0.9991 - val_loss: 2.3892 - val_acc: 0.7689
    Epoch 84/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992Epoch 00083: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2940 - val_acc: 0.7725
    Epoch 85/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00084: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3673 - val_acc: 0.7737
    Epoch 86/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00085: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3691 - val_acc: 0.7784
    Epoch 87/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00086: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3928 - val_acc: 0.7677
    Epoch 88/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00087: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4299 - val_acc: 0.7641
    Epoch 89/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00088: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.3118 - val_acc: 0.7605
    Epoch 90/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00089: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0097 - acc: 0.9994 - val_loss: 2.3764 - val_acc: 0.7701
    Epoch 91/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00090: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3772 - val_acc: 0.7689
    Epoch 92/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0116 - acc: 0.9992    Epoch 00091: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.3511 - val_acc: 0.7749
    Epoch 93/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0107 - acc: 0.9992    Epoch 00092: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0104 - acc: 0.9993 - val_loss: 2.3428 - val_acc: 0.7689
    Epoch 94/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00093: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0126 - acc: 0.9991 - val_loss: 2.3113 - val_acc: 0.7689
    Epoch 95/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00094: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3766 - val_acc: 0.7641
    Epoch 96/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00095: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3964 - val_acc: 0.7629
    Epoch 97/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00096: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3757 - val_acc: 0.7725
    Epoch 98/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0112 - acc: 0.9992    Epoch 00097: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0112 - acc: 0.9993 - val_loss: 2.3442 - val_acc: 0.7725
    Epoch 99/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0137 - acc: 0.9991    Epoch 00098: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0133 - acc: 0.9991 - val_loss: 2.3872 - val_acc: 0.7689
    Epoch 100/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00099: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4087 - val_acc: 0.7760
    Epoch 101/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992Epoch 00100: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3706 - val_acc: 0.7808
    Epoch 102/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0114 - acc: 0.9992    Epoch 00101: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0113 - acc: 0.9993 - val_loss: 2.5285 - val_acc: 0.7521
    Epoch 103/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00102: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.4439 - val_acc: 0.7641
    Epoch 104/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00103: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4218 - val_acc: 0.7677
    Epoch 105/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00104: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3813 - val_acc: 0.7593
    Epoch 106/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00105: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9993 - val_loss: 2.3606 - val_acc: 0.7653
    Epoch 107/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00106: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4094 - val_acc: 0.7653
    Epoch 108/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00107: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3716 - val_acc: 0.7641
    Epoch 109/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0116 - acc: 0.9991    Epoch 00108: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0130 - acc: 0.9990 - val_loss: 2.2631 - val_acc: 0.7725
    Epoch 110/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00109: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2616 - val_acc: 0.7784
    Epoch 111/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0079 - acc: 0.9994    Epoch 00110: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0101 - acc: 0.9993 - val_loss: 2.3060 - val_acc: 0.7701
    Epoch 112/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0109 - acc: 0.9992    Epoch 00111: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0106 - acc: 0.9993 - val_loss: 2.3344 - val_acc: 0.7796
    Epoch 113/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9992    Epoch 00112: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0116 - acc: 0.9993 - val_loss: 2.2896 - val_acc: 0.7808
    Epoch 114/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0130 - acc: 0.9991    Epoch 00113: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0129 - acc: 0.9991 - val_loss: 2.3349 - val_acc: 0.7677
    Epoch 115/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0127 - acc: 0.9991    Epoch 00114: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0125 - acc: 0.9991 - val_loss: 2.2718 - val_acc: 0.7749
    Epoch 116/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0111 - acc: 0.9992    Epoch 00115: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0107 - acc: 0.9993 - val_loss: 2.3060 - val_acc: 0.7796
    Epoch 117/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0108 - acc: 0.9991    Epoch 00116: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0108 - acc: 0.9991 - val_loss: 2.2722 - val_acc: 0.7725
    Epoch 118/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0115 - acc: 0.9992    Epoch 00117: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0115 - acc: 0.9993 - val_loss: 2.2815 - val_acc: 0.7832
    Epoch 119/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0105 - acc: 0.9992    Epoch 00118: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0104 - acc: 0.9993 - val_loss: 2.2257 - val_acc: 0.7820
    Epoch 120/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00119: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2744 - val_acc: 0.7784
    Epoch 121/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00120: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2795 - val_acc: 0.7832
    Epoch 122/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0118 - acc: 0.9992    Epoch 00121: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0118 - acc: 0.9993 - val_loss: 2.2853 - val_acc: 0.7784
    Epoch 123/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00122: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2970 - val_acc: 0.7677
    Epoch 124/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00123: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2909 - val_acc: 0.7760
    Epoch 125/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00124: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3342 - val_acc: 0.7820
    Epoch 126/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00125: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3025 - val_acc: 0.7713
    Epoch 127/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0149 - acc: 0.9991    Epoch 00126: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0144 - acc: 0.9991 - val_loss: 2.3318 - val_acc: 0.7653
    Epoch 128/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0158 - acc: 0.9989    Epoch 00127: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0157 - acc: 0.9990 - val_loss: 2.3139 - val_acc: 0.7641
    Epoch 129/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0146 - acc: 0.9991    Epoch 00128: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0142 - acc: 0.9991 - val_loss: 2.3850 - val_acc: 0.7701
    Epoch 130/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00129: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3753 - val_acc: 0.7749
    Epoch 131/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00130: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4285 - val_acc: 0.7725
    Epoch 132/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0133 - acc: 0.9991    Epoch 00131: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0132 - acc: 0.9991 - val_loss: 2.2912 - val_acc: 0.7832
    Epoch 133/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00132: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2885 - val_acc: 0.7856
    Epoch 134/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00133: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2993 - val_acc: 0.7760
    Epoch 135/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0145 - acc: 0.9991    Epoch 00134: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0140 - acc: 0.9991 - val_loss: 2.3463 - val_acc: 0.7796
    Epoch 136/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0142 - acc: 0.9991    Epoch 00135: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0137 - acc: 0.9991 - val_loss: 2.3409 - val_acc: 0.7713
    Epoch 137/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992Epoch 00136: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3665 - val_acc: 0.7737
    Epoch 138/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00137: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3270 - val_acc: 0.7844
    Epoch 139/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00138: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3290 - val_acc: 0.7713
    Epoch 140/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00139: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4435 - val_acc: 0.7749
    Epoch 141/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00140: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4171 - val_acc: 0.7832
    Epoch 142/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00141: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3126 - val_acc: 0.7940
    Epoch 143/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00142: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2961 - val_acc: 0.7868
    Epoch 144/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00143: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2980 - val_acc: 0.7832
    Epoch 145/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00144: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0111 - acc: 0.9993 - val_loss: 2.3223 - val_acc: 0.7713
    Epoch 146/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00145: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3074 - val_acc: 0.7749
    Epoch 147/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00146: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2690 - val_acc: 0.7737
    Epoch 148/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992Epoch 00147: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2953 - val_acc: 0.7749
    Epoch 149/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00148: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3040 - val_acc: 0.7701
    Epoch 150/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9991    Epoch 00149: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0120 - acc: 0.9991 - val_loss: 2.3076 - val_acc: 0.7796
    Epoch 151/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00150: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4691 - val_acc: 0.7760
    Epoch 152/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0106 - acc: 0.9992    Epoch 00151: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0104 - acc: 0.9993 - val_loss: 2.2872 - val_acc: 0.7713
    Epoch 153/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00152: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2426 - val_acc: 0.7832
    Epoch 154/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00153: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2736 - val_acc: 0.7904
    Epoch 155/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0123 - acc: 0.9992Epoch 00154: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.3813 - val_acc: 0.7808
    Epoch 156/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00155: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0125 - acc: 0.9991 - val_loss: 2.3132 - val_acc: 0.7701
    Epoch 157/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00156: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3994 - val_acc: 0.7689
    Epoch 158/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0129 - acc: 0.9991    Epoch 00157: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.3148 - val_acc: 0.7760
    Epoch 159/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0143 - acc: 0.9991    Epoch 00158: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0138 - acc: 0.9991 - val_loss: 2.3502 - val_acc: 0.7844
    Epoch 160/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0133 - acc: 0.9991    Epoch 00159: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0133 - acc: 0.9991 - val_loss: 2.3017 - val_acc: 0.7725
    Epoch 161/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9991    Epoch 00160: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9991 - val_loss: 2.2853 - val_acc: 0.7832
    Epoch 162/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00161: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2434 - val_acc: 0.7784
    Epoch 163/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0113 - acc: 0.9992    Epoch 00162: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0110 - acc: 0.9993 - val_loss: 2.2885 - val_acc: 0.7737
    Epoch 164/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0142 - acc: 0.9991    Epoch 00163: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0137 - acc: 0.9991 - val_loss: 2.2588 - val_acc: 0.7737
    Epoch 165/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00164: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2812 - val_acc: 0.7713
    Epoch 166/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0104 - acc: 0.9992    Epoch 00165: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0102 - acc: 0.9993 - val_loss: 2.2178 - val_acc: 0.7772
    Epoch 167/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00166: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3044 - val_acc: 0.7725
    Epoch 168/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00167: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2832 - val_acc: 0.7713
    Epoch 169/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00168: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2728 - val_acc: 0.7796
    Epoch 170/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0098 - acc: 0.9994    Epoch 00169: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2702 - val_acc: 0.7725
    Epoch 171/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0142 - acc: 0.9991    Epoch 00170: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0141 - acc: 0.9991 - val_loss: 2.2997 - val_acc: 0.7832
    Epoch 172/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0142 - acc: 0.9991    Epoch 00171: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0139 - acc: 0.9991 - val_loss: 2.2657 - val_acc: 0.7749
    Epoch 173/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0097 - acc: 0.9992    Epoch 00172: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0108 - acc: 0.9991 - val_loss: 2.3145 - val_acc: 0.7784
    Epoch 174/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00173: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3124 - val_acc: 0.7784
    Epoch 175/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9992    Epoch 00174: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.3440 - val_acc: 0.7701
    Epoch 176/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00175: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.2799 - val_acc: 0.7737
    Epoch 177/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0117 - acc: 0.9992    Epoch 00176: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0139 - acc: 0.9991 - val_loss: 2.2976 - val_acc: 0.7677
    Epoch 178/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00177: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2841 - val_acc: 0.7808
    Epoch 179/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00178: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2611 - val_acc: 0.7737
    Epoch 180/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00179: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3284 - val_acc: 0.7784
    Epoch 181/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00180: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3380 - val_acc: 0.7701
    Epoch 182/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00181: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3607 - val_acc: 0.7713
    Epoch 183/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00182: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3185 - val_acc: 0.7772
    Epoch 184/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00183: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3330 - val_acc: 0.7701
    Epoch 185/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0120 - acc: 0.9992    Epoch 00184: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.3155 - val_acc: 0.7689
    Epoch 186/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0141 - acc: 0.9989    Epoch 00185: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0138 - acc: 0.9990 - val_loss: 2.2512 - val_acc: 0.7737
    Epoch 187/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0115 - acc: 0.9989    Epoch 00186: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0111 - acc: 0.9990 - val_loss: 2.2846 - val_acc: 0.7677
    Epoch 188/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9991    Epoch 00187: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0120 - acc: 0.9991 - val_loss: 2.3593 - val_acc: 0.7856
    Epoch 189/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0117 - acc: 0.9988    Epoch 00188: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0115 - acc: 0.9988 - val_loss: 2.3553 - val_acc: 0.7701
    Epoch 190/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0142 - acc: 0.9991    Epoch 00189: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0138 - acc: 0.9991 - val_loss: 2.3355 - val_acc: 0.7653
    Epoch 191/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00190: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3922 - val_acc: 0.7701
    Epoch 192/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00191: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.3567 - val_acc: 0.7808
    Epoch 193/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0127 - acc: 0.9991    Epoch 00192: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.3542 - val_acc: 0.7749
    Epoch 194/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00193: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3558 - val_acc: 0.7749
    Epoch 195/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00194: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3644 - val_acc: 0.7701
    Epoch 196/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00195: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4042 - val_acc: 0.7689
    Epoch 197/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00196: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3416 - val_acc: 0.7808
    Epoch 198/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0136 - acc: 0.9991    Epoch 00197: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0135 - acc: 0.9991 - val_loss: 2.3258 - val_acc: 0.7749
    Epoch 199/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00198: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3866 - val_acc: 0.7689
    Epoch 200/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00199: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3637 - val_acc: 0.7713
    Epoch 201/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00200: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2788 - val_acc: 0.7701
    Epoch 202/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00201: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0120 - acc: 0.9993 - val_loss: 2.3195 - val_acc: 0.7832
    Epoch 203/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9992    Epoch 00202: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0118 - acc: 0.9993 - val_loss: 2.3186 - val_acc: 0.7749
    Epoch 204/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0127 - acc: 0.9991    Epoch 00203: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0124 - acc: 0.9991 - val_loss: 2.4443 - val_acc: 0.7713
    Epoch 205/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0134 - acc: 0.9991    Epoch 00204: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0130 - acc: 0.9991 - val_loss: 2.4017 - val_acc: 0.7629
    Epoch 206/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0133 - acc: 0.9991    Epoch 00205: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0130 - acc: 0.9991 - val_loss: 2.3283 - val_acc: 0.7832
    Epoch 207/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0132 - acc: 0.9991    Epoch 00206: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0131 - acc: 0.9991 - val_loss: 2.3190 - val_acc: 0.7832
    Epoch 208/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00207: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2307 - val_acc: 0.7904
    Epoch 209/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00208: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3124 - val_acc: 0.7856
    Epoch 210/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9992    Epoch 00209: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.3765 - val_acc: 0.7749
    Epoch 211/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00210: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3594 - val_acc: 0.7689
    Epoch 212/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00211: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4221 - val_acc: 0.7713
    Epoch 213/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0109 - acc: 0.9992    Epoch 00212: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0115 - acc: 0.9991 - val_loss: 2.3484 - val_acc: 0.7737
    Epoch 214/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0105 - acc: 0.9992    Epoch 00213: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0104 - acc: 0.9993 - val_loss: 2.3971 - val_acc: 0.7665
    Epoch 215/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0112 - acc: 0.9991    Epoch 00214: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0111 - acc: 0.9991 - val_loss: 2.3934 - val_acc: 0.7617
    Epoch 216/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0123 - acc: 0.9991    Epoch 00215: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0143 - acc: 0.9990 - val_loss: 2.4021 - val_acc: 0.7533
    Epoch 217/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0114 - acc: 0.9992    Epoch 00216: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0112 - acc: 0.9993 - val_loss: 2.2684 - val_acc: 0.7701
    Epoch 218/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00217: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3318 - val_acc: 0.7737
    Epoch 219/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0120 - acc: 0.9992    Epoch 00218: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.4241 - val_acc: 0.7557
    Epoch 220/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0108 - acc: 0.9991    Epoch 00219: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0104 - acc: 0.9991 - val_loss: 2.3361 - val_acc: 0.7677
    Epoch 221/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0134 - acc: 0.9989    Epoch 00220: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0132 - acc: 0.9990 - val_loss: 2.3918 - val_acc: 0.7665
    Epoch 222/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0135 - acc: 0.9991    Epoch 00221: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0131 - acc: 0.9991 - val_loss: 2.2542 - val_acc: 0.7760
    Epoch 223/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0147 - acc: 0.9989    Epoch 00222: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0146 - acc: 0.9990 - val_loss: 2.3589 - val_acc: 0.7521
    Epoch 224/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0062 - acc: 0.9994    Epoch 00223: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0109 - acc: 0.9991 - val_loss: 2.4177 - val_acc: 0.7665
    Epoch 225/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00224: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3893 - val_acc: 0.7689
    Epoch 226/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0115 - acc: 0.9989    Epoch 00225: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0114 - acc: 0.9990 - val_loss: 2.4072 - val_acc: 0.7689
    Epoch 227/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0118 - acc: 0.9992    Epoch 00226: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.4085 - val_acc: 0.7617
    Epoch 228/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9989    Epoch 00227: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9990 - val_loss: 2.4725 - val_acc: 0.7605
    Epoch 229/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0106 - acc: 0.9992    Epoch 00228: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0105 - acc: 0.9993 - val_loss: 2.4799 - val_acc: 0.7653
    Epoch 230/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0141 - acc: 0.9991    Epoch 00229: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0137 - acc: 0.9991 - val_loss: 2.3669 - val_acc: 0.7641
    Epoch 231/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0117 - acc: 0.9992    Epoch 00230: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.3865 - val_acc: 0.7725
    Epoch 232/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00231: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4265 - val_acc: 0.7653
    Epoch 233/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0114 - acc: 0.9991    Epoch 00232: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0110 - acc: 0.9991 - val_loss: 2.5228 - val_acc: 0.7593
    Epoch 234/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00233: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3501 - val_acc: 0.7641
    Epoch 235/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00234: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0120 - acc: 0.9993 - val_loss: 2.3810 - val_acc: 0.7677
    Epoch 236/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00235: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2851 - val_acc: 0.7653
    Epoch 237/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00236: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3358 - val_acc: 0.7713
    Epoch 238/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00237: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2838 - val_acc: 0.7772
    Epoch 239/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0115 - acc: 0.9992    Epoch 00238: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0113 - acc: 0.9993 - val_loss: 2.3562 - val_acc: 0.7713
    Epoch 240/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00239: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2908 - val_acc: 0.7713
    Epoch 241/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00240: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4229 - val_acc: 0.7653
    Epoch 242/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00241: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3959 - val_acc: 0.7617
    Epoch 243/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0090 - acc: 0.9994    Epoch 00242: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.3153 - val_acc: 0.7689
    Epoch 244/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00243: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3285 - val_acc: 0.7653
    Epoch 245/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0149 - acc: 0.9991    Epoch 00244: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0145 - acc: 0.9991 - val_loss: 2.3601 - val_acc: 0.7581
    Epoch 246/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0136 - acc: 0.9991    Epoch 00245: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0131 - acc: 0.9991 - val_loss: 2.3804 - val_acc: 0.7677
    Epoch 247/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00246: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0097 - acc: 0.9994 - val_loss: 2.3000 - val_acc: 0.7641
    Epoch 248/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00247: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3943 - val_acc: 0.7593
    Epoch 249/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00248: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3897 - val_acc: 0.7653
    Epoch 250/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0130 - acc: 0.9991    Epoch 00249: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0128 - acc: 0.9991 - val_loss: 2.3552 - val_acc: 0.7701
    Epoch 251/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0109 - acc: 0.9992    Epoch 00250: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0107 - acc: 0.9993 - val_loss: 2.2217 - val_acc: 0.7725
    Epoch 252/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00251: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2561 - val_acc: 0.7772
    Epoch 253/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0112 - acc: 0.9992    Epoch 00252: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0134 - acc: 0.9991 - val_loss: 2.3532 - val_acc: 0.7617
    Epoch 254/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00253: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3289 - val_acc: 0.7617
    Epoch 255/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00254: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3095 - val_acc: 0.7749
    Epoch 256/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0107 - acc: 0.9992    Epoch 00255: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0128 - acc: 0.9991 - val_loss: 2.3367 - val_acc: 0.7629
    Epoch 257/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00256: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3510 - val_acc: 0.7701
    Epoch 258/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0115 - acc: 0.9992    Epoch 00257: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0115 - acc: 0.9993 - val_loss: 2.2450 - val_acc: 0.7749
    Epoch 259/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0144 - acc: 0.9989    Epoch 00258: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0144 - acc: 0.9990 - val_loss: 2.2691 - val_acc: 0.7629
    Epoch 260/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00259: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3648 - val_acc: 0.7677
    Epoch 261/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00260: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3098 - val_acc: 0.7593
    Epoch 262/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00261: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0126 - acc: 0.9991 - val_loss: 2.2915 - val_acc: 0.7509
    Epoch 263/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00262: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3616 - val_acc: 0.7605
    Epoch 264/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0132 - acc: 0.9991    Epoch 00263: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.2842 - val_acc: 0.7665
    Epoch 265/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0130 - acc: 0.9991    Epoch 00264: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0126 - acc: 0.9991 - val_loss: 2.4104 - val_acc: 0.7713
    Epoch 266/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0118 - acc: 0.9991    Epoch 00265: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0116 - acc: 0.9991 - val_loss: 2.3290 - val_acc: 0.7641
    Epoch 267/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00266: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3369 - val_acc: 0.7737
    Epoch 268/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0141 - acc: 0.9991    Epoch 00267: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.4274 - val_acc: 0.7689
    Epoch 269/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00268: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4170 - val_acc: 0.7617
    Epoch 270/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0161 - acc: 0.9989    Epoch 00269: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0157 - acc: 0.9990 - val_loss: 2.3219 - val_acc: 0.7665
    Epoch 271/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00270: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2608 - val_acc: 0.7701
    Epoch 272/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00271: val_loss improved from 2.21296 to 2.20403, saving model to saved_models/weights.best.Inc_model.hdf5
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2040 - val_acc: 0.7749
    Epoch 273/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0131 - acc: 0.9989    Epoch 00272: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0129 - acc: 0.9990 - val_loss: 2.2397 - val_acc: 0.7784
    Epoch 274/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0109 - acc: 0.9992    Epoch 00273: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0131 - acc: 0.9991 - val_loss: 2.2975 - val_acc: 0.7713
    Epoch 275/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00274: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3655 - val_acc: 0.7749
    Epoch 276/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0091 - acc: 0.9994    Epoch 00275: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0113 - acc: 0.9993 - val_loss: 2.3144 - val_acc: 0.7725
    Epoch 277/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00276: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2847 - val_acc: 0.7665
    Epoch 278/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0098 - acc: 0.9994    Epoch 00277: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2976 - val_acc: 0.7557
    Epoch 279/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00278: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9993 - val_loss: 2.3072 - val_acc: 0.7713
    Epoch 280/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00279: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3780 - val_acc: 0.7653
    Epoch 281/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00280: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3201 - val_acc: 0.7701
    Epoch 282/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00281: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2174 - val_acc: 0.7832
    Epoch 283/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0132 - acc: 0.9991    Epoch 00282: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0132 - acc: 0.9991 - val_loss: 2.2924 - val_acc: 0.7749
    Epoch 284/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00283: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3232 - val_acc: 0.7725
    Epoch 285/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00284: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3415 - val_acc: 0.7760
    Epoch 286/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00285: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3536 - val_acc: 0.7665
    Epoch 287/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0135 - acc: 0.9991    Epoch 00286: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0133 - acc: 0.9991 - val_loss: 2.2218 - val_acc: 0.7772
    Epoch 288/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0084 - acc: 0.9994    Epoch 00287: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0107 - acc: 0.9993 - val_loss: 2.3443 - val_acc: 0.7653
    Epoch 289/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00288: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2180 - val_acc: 0.7689
    Epoch 290/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0134 - acc: 0.9991    Epoch 00289: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0130 - acc: 0.9991 - val_loss: 2.3810 - val_acc: 0.7653
    Epoch 291/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0109 - acc: 0.9992    Epoch 00290: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0105 - acc: 0.9993 - val_loss: 2.3587 - val_acc: 0.7653
    Epoch 292/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0140 - acc: 0.9991    Epoch 00291: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.4095 - val_acc: 0.7689
    Epoch 293/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00292: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3408 - val_acc: 0.7808
    Epoch 294/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00293: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3928 - val_acc: 0.7713
    Epoch 295/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00294: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4154 - val_acc: 0.7701
    Epoch 296/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0091 - acc: 0.9992    Epoch 00295: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0114 - acc: 0.9991 - val_loss: 2.4113 - val_acc: 0.7725
    Epoch 297/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00296: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3373 - val_acc: 0.7629
    Epoch 298/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0129 - acc: 0.9991    Epoch 00297: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.2424 - val_acc: 0.7689
    Epoch 299/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00298: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0141 - acc: 0.9991 - val_loss: 2.2463 - val_acc: 0.7713
    Epoch 300/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00299: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3940 - val_acc: 0.7617
    Epoch 301/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00300: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4358 - val_acc: 0.7784
    Epoch 302/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0116 - acc: 0.9992    Epoch 00301: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0115 - acc: 0.9993 - val_loss: 2.3769 - val_acc: 0.7665
    Epoch 303/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0117 - acc: 0.9992    Epoch 00302: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0116 - acc: 0.9993 - val_loss: 2.2608 - val_acc: 0.7772
    Epoch 304/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0127 - acc: 0.9991    Epoch 00303: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9991 - val_loss: 2.3835 - val_acc: 0.7653
    Epoch 305/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00304: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3349 - val_acc: 0.7593
    Epoch 306/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00305: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3820 - val_acc: 0.7665
    Epoch 307/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0137 - acc: 0.9991    Epoch 00306: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.5017 - val_acc: 0.7569
    Epoch 308/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0129 - acc: 0.9991    Epoch 00307: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0126 - acc: 0.9991 - val_loss: 2.4537 - val_acc: 0.7629
    Epoch 309/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0129 - acc: 0.9991Epoch 00308: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0125 - acc: 0.9991 - val_loss: 2.3346 - val_acc: 0.7772
    Epoch 310/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0143 - acc: 0.9991    Epoch 00309: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0140 - acc: 0.9991 - val_loss: 2.3606 - val_acc: 0.7677
    Epoch 311/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0109 - acc: 0.9992    Epoch 00310: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0109 - acc: 0.9993 - val_loss: 2.2969 - val_acc: 0.7701
    Epoch 312/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0112 - acc: 0.9992    Epoch 00311: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.2157 - val_acc: 0.7796
    Epoch 313/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0134 - acc: 0.9991    Epoch 00312: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0131 - acc: 0.9991 - val_loss: 2.2166 - val_acc: 0.7868
    Epoch 314/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00313: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0097 - acc: 0.9994 - val_loss: 2.2261 - val_acc: 0.7844
    Epoch 315/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0090 - acc: 0.9994    Epoch 00314: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0111 - acc: 0.9993 - val_loss: 2.3838 - val_acc: 0.7737
    Epoch 316/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00315: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0125 - acc: 0.9991 - val_loss: 2.3863 - val_acc: 0.7713
    Epoch 317/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0118 - acc: 0.9991    Epoch 00316: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9991 - val_loss: 2.3348 - val_acc: 0.7737
    Epoch 318/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0114 - acc: 0.9992    Epoch 00317: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0111 - acc: 0.9993 - val_loss: 2.5256 - val_acc: 0.7533
    Epoch 319/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0118 - acc: 0.9992    Epoch 00318: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.4272 - val_acc: 0.7677
    Epoch 320/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0136 - acc: 0.9989    Epoch 00319: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9990 - val_loss: 2.4258 - val_acc: 0.7605
    Epoch 321/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00320: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4170 - val_acc: 0.7677
    Epoch 322/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00321: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4600 - val_acc: 0.7737
    Epoch 323/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0138 - acc: 0.9991    Epoch 00322: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0135 - acc: 0.9991 - val_loss: 2.3965 - val_acc: 0.7617
    Epoch 324/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00323: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0124 - acc: 0.9991 - val_loss: 2.4467 - val_acc: 0.7677
    Epoch 325/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0115 - acc: 0.9992    Epoch 00324: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0115 - acc: 0.9993 - val_loss: 2.3830 - val_acc: 0.7701
    Epoch 326/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0101 - acc: 0.9994    Epoch 00325: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3379 - val_acc: 0.7737
    Epoch 327/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00326: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3262 - val_acc: 0.7749
    Epoch 328/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00327: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3428 - val_acc: 0.7725
    Epoch 329/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00328: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2853 - val_acc: 0.7653
    Epoch 330/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00329: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3294 - val_acc: 0.7784
    Epoch 331/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00330: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3796 - val_acc: 0.7689
    Epoch 332/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0102 - acc: 0.9992    Epoch 00331: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0124 - acc: 0.9991 - val_loss: 2.3457 - val_acc: 0.7689
    Epoch 333/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9991    Epoch 00332: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0123 - acc: 0.9991 - val_loss: 2.3757 - val_acc: 0.7641
    Epoch 334/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00333: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3392 - val_acc: 0.7725
    Epoch 335/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00334: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3962 - val_acc: 0.7665
    Epoch 336/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00335: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2358 - val_acc: 0.7689
    Epoch 337/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0103 - acc: 0.9992    Epoch 00336: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0102 - acc: 0.9993 - val_loss: 2.3295 - val_acc: 0.7772
    Epoch 338/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9991    Epoch 00337: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9991 - val_loss: 2.3272 - val_acc: 0.7796
    Epoch 339/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0118 - acc: 0.9991    Epoch 00338: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9991 - val_loss: 2.3318 - val_acc: 0.7772
    Epoch 340/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0111 - acc: 0.9992    Epoch 00339: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0109 - acc: 0.9993 - val_loss: 2.3246 - val_acc: 0.7808
    Epoch 341/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0135 - acc: 0.9991    Epoch 00340: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0131 - acc: 0.9991 - val_loss: 2.3928 - val_acc: 0.7689
    Epoch 342/2000
    6420/6680 [===========================>..] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00341: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4162 - val_acc: 0.7677
    Epoch 343/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00342: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4665 - val_acc: 0.7725
    Epoch 344/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0136 - acc: 0.9991    Epoch 00343: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0135 - acc: 0.9991 - val_loss: 2.4189 - val_acc: 0.7772
    Epoch 345/2000
    6420/6680 [===========================>..] - ETA: 0s - loss: 0.0126 - acc: 0.9992    Epoch 00344: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4454 - val_acc: 0.7665
    Epoch 346/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00345: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3750 - val_acc: 0.7749
    Epoch 347/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0129 - acc: 0.9991    Epoch 00346: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0128 - acc: 0.9991 - val_loss: 2.4026 - val_acc: 0.7617
    Epoch 348/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0116 - acc: 0.9992    Epoch 00347: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0114 - acc: 0.9993 - val_loss: 2.4143 - val_acc: 0.7689
    Epoch 349/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0101 - acc: 0.9992    Epoch 00348: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9991 - val_loss: 2.4866 - val_acc: 0.7701
    Epoch 350/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00349: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4190 - val_acc: 0.7737
    Epoch 351/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00350: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3809 - val_acc: 0.7641
    Epoch 352/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9992    Epoch 00351: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0100 - acc: 0.9993 - val_loss: 2.3296 - val_acc: 0.7772
    Epoch 353/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00352: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0124 - acc: 0.9991 - val_loss: 2.4381 - val_acc: 0.7725
    Epoch 354/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00353: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4051 - val_acc: 0.7665
    Epoch 355/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9991    Epoch 00354: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9991 - val_loss: 2.2892 - val_acc: 0.7796
    Epoch 356/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00355: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2848 - val_acc: 0.7916
    Epoch 357/2000
    6420/6680 [===========================>..] - ETA: 0s - loss: 0.0126 - acc: 0.9992    Epoch 00356: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2752 - val_acc: 0.7749
    Epoch 358/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0141 - acc: 0.9991    Epoch 00357: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0136 - acc: 0.9991 - val_loss: 2.3131 - val_acc: 0.7701
    Epoch 359/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0112 - acc: 0.9992    Epoch 00358: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0112 - acc: 0.9993 - val_loss: 2.3535 - val_acc: 0.7629
    Epoch 360/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0139 - acc: 0.9991    Epoch 00359: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0138 - acc: 0.9991 - val_loss: 2.3276 - val_acc: 0.7701
    Epoch 361/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0103 - acc: 0.9992Epoch 00360: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0124 - acc: 0.9991 - val_loss: 2.4408 - val_acc: 0.7701
    Epoch 362/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0140 - acc: 0.9991    Epoch 00361: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0139 - acc: 0.9991 - val_loss: 2.3861 - val_acc: 0.7641
    Epoch 363/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00362: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3906 - val_acc: 0.7689
    Epoch 364/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00363: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3544 - val_acc: 0.7677
    Epoch 365/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00364: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.3695 - val_acc: 0.7629
    Epoch 366/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992Epoch 00365: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3109 - val_acc: 0.7784
    Epoch 367/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00366: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2918 - val_acc: 0.7737
    Epoch 368/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00367: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3479 - val_acc: 0.7760
    Epoch 369/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00368: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4269 - val_acc: 0.7653
    Epoch 370/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00369: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3944 - val_acc: 0.7760
    Epoch 371/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00370: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.4715 - val_acc: 0.7665
    Epoch 372/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0098 - acc: 0.9994    Epoch 00371: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4444 - val_acc: 0.7605
    Epoch 373/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0137 - acc: 0.9991    Epoch 00372: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0133 - acc: 0.9991 - val_loss: 2.4010 - val_acc: 0.7725
    Epoch 374/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00373: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3613 - val_acc: 0.7737
    Epoch 375/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0130 - acc: 0.9991    Epoch 00374: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0129 - acc: 0.9991 - val_loss: 2.3685 - val_acc: 0.7701
    Epoch 376/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00375: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0097 - acc: 0.9994 - val_loss: 2.3709 - val_acc: 0.7772
    Epoch 377/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0134 - acc: 0.9991    Epoch 00376: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0129 - acc: 0.9991 - val_loss: 2.3959 - val_acc: 0.7713
    Epoch 378/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0117 - acc: 0.9991    Epoch 00377: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0113 - acc: 0.9991 - val_loss: 2.3628 - val_acc: 0.7701
    Epoch 379/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00378: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3571 - val_acc: 0.7737
    Epoch 380/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00379: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3851 - val_acc: 0.7713
    Epoch 381/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00380: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3941 - val_acc: 0.7808
    Epoch 382/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00381: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3848 - val_acc: 0.7784
    Epoch 383/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0116 - acc: 0.9992    Epoch 00382: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0112 - acc: 0.9993 - val_loss: 2.3677 - val_acc: 0.7737
    Epoch 384/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0107 - acc: 0.9992    Epoch 00383: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0105 - acc: 0.9993 - val_loss: 2.3401 - val_acc: 0.7641
    Epoch 385/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0094 - acc: 0.9994    Epoch 00384: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0114 - acc: 0.9993 - val_loss: 2.4091 - val_acc: 0.7665
    Epoch 386/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00385: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3606 - val_acc: 0.7749
    Epoch 387/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00386: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3465 - val_acc: 0.7749
    Epoch 388/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00387: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3483 - val_acc: 0.7749
    Epoch 389/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00388: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3931 - val_acc: 0.7737
    Epoch 390/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00389: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3752 - val_acc: 0.7689
    Epoch 391/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00390: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2835 - val_acc: 0.7820
    Epoch 392/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00391: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3535 - val_acc: 0.7725
    Epoch 393/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00392: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4237 - val_acc: 0.7665
    Epoch 394/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0098 - acc: 0.9992    Epoch 00393: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0098 - acc: 0.9993 - val_loss: 2.3591 - val_acc: 0.7677
    Epoch 395/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0110 - acc: 0.9992    Epoch 00394: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0107 - acc: 0.9993 - val_loss: 2.3603 - val_acc: 0.7641
    Epoch 396/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00395: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2583 - val_acc: 0.7677
    Epoch 397/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00396: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3338 - val_acc: 0.7725
    Epoch 398/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9991    Epoch 00397: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9991 - val_loss: 2.2815 - val_acc: 0.7701
    Epoch 399/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0101 - acc: 0.9992    Epoch 00398: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0099 - acc: 0.9993 - val_loss: 2.3250 - val_acc: 0.7737
    Epoch 400/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0108 - acc: 0.9992    Epoch 00399: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0106 - acc: 0.9993 - val_loss: 2.2828 - val_acc: 0.7713
    Epoch 401/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0112 - acc: 0.9992    Epoch 00400: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0110 - acc: 0.9993 - val_loss: 2.2993 - val_acc: 0.7749
    Epoch 402/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0098 - acc: 0.9994    Epoch 00401: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2980 - val_acc: 0.7760
    Epoch 403/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0096 - acc: 0.9994    Epoch 00402: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0118 - acc: 0.9993 - val_loss: 2.2342 - val_acc: 0.7856
    Epoch 404/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0136 - acc: 0.9991    Epoch 00403: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0135 - acc: 0.9991 - val_loss: 2.2619 - val_acc: 0.7820
    Epoch 405/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00404: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2120 - val_acc: 0.7880
    Epoch 406/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00405: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2729 - val_acc: 0.7772
    Epoch 407/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00406: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3250 - val_acc: 0.7701
    Epoch 408/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0108 - acc: 0.9992    Epoch 00407: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0105 - acc: 0.9993 - val_loss: 2.3775 - val_acc: 0.7725
    Epoch 409/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00408: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0124 - acc: 0.9991 - val_loss: 2.3325 - val_acc: 0.7749
    Epoch 410/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00409: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3323 - val_acc: 0.7832
    Epoch 411/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0118 - acc: 0.9992    Epoch 00410: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0117 - acc: 0.9993 - val_loss: 2.2924 - val_acc: 0.7689
    Epoch 412/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00411: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2335 - val_acc: 0.7737
    Epoch 413/2000
    6420/6680 [===========================>..] - ETA: 0s - loss: 0.0119 - acc: 0.9992    Epoch 00412: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0116 - acc: 0.9991 - val_loss: 2.3460 - val_acc: 0.7641
    Epoch 414/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00413: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3677 - val_acc: 0.7701
    Epoch 415/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00414: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3476 - val_acc: 0.7713
    Epoch 416/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00415: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4051 - val_acc: 0.7737
    Epoch 417/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0142 - acc: 0.9991    Epoch 00416: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0138 - acc: 0.9991 - val_loss: 2.5300 - val_acc: 0.7605
    Epoch 418/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0120 - acc: 0.9992    Epoch 00417: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.4914 - val_acc: 0.7617
    Epoch 419/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00418: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0097 - acc: 0.9994 - val_loss: 2.4082 - val_acc: 0.7641
    Epoch 420/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9991    Epoch 00419: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0124 - acc: 0.9991 - val_loss: 2.3980 - val_acc: 0.7725
    Epoch 421/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00420: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4112 - val_acc: 0.7772
    Epoch 422/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00421: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3724 - val_acc: 0.7713
    Epoch 423/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00422: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4240 - val_acc: 0.7653
    Epoch 424/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00423: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3971 - val_acc: 0.7641
    Epoch 425/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9991    Epoch 00424: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0116 - acc: 0.9991 - val_loss: 2.4003 - val_acc: 0.7689
    Epoch 426/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9992    Epoch 00425: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0100 - acc: 0.9993 - val_loss: 2.3437 - val_acc: 0.7808
    Epoch 427/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0108 - acc: 0.9992    Epoch 00426: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0104 - acc: 0.9993 - val_loss: 2.3181 - val_acc: 0.7844
    Epoch 428/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9991    Epoch 00427: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0122 - acc: 0.9991 - val_loss: 2.3720 - val_acc: 0.7820
    Epoch 429/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9989    Epoch 00428: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9990 - val_loss: 2.3771 - val_acc: 0.7737
    Epoch 430/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00429: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3674 - val_acc: 0.7689
    Epoch 431/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00430: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3632 - val_acc: 0.7749
    Epoch 432/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00431: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3003 - val_acc: 0.7760
    Epoch 433/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00432: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3282 - val_acc: 0.7701
    Epoch 434/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00433: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3010 - val_acc: 0.7760
    Epoch 435/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00434: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2928 - val_acc: 0.7749
    Epoch 436/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00435: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2307 - val_acc: 0.7808
    Epoch 437/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0114 - acc: 0.9992    Epoch 00436: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0112 - acc: 0.9993 - val_loss: 2.2689 - val_acc: 0.7832
    Epoch 438/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00437: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2508 - val_acc: 0.7725
    Epoch 439/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00438: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3024 - val_acc: 0.7713
    Epoch 440/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00439: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3353 - val_acc: 0.7737
    Epoch 441/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00440: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3304 - val_acc: 0.7832
    Epoch 442/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0145 - acc: 0.9991    Epoch 00441: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0142 - acc: 0.9991 - val_loss: 2.4075 - val_acc: 0.7784
    Epoch 443/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00442: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4738 - val_acc: 0.7653
    Epoch 444/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9991    Epoch 00443: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0120 - acc: 0.9991 - val_loss: 2.3947 - val_acc: 0.7725
    Epoch 445/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0098 - acc: 0.9994    Epoch 00444: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0118 - acc: 0.9993 - val_loss: 2.3461 - val_acc: 0.7832
    Epoch 446/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00445: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.3108 - val_acc: 0.7844
    Epoch 447/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9991    Epoch 00446: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0123 - acc: 0.9991 - val_loss: 2.3492 - val_acc: 0.7916
    Epoch 448/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0109 - acc: 0.9992    Epoch 00447: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0106 - acc: 0.9993 - val_loss: 2.3951 - val_acc: 0.7737
    Epoch 449/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0116 - acc: 0.9992    Epoch 00448: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0114 - acc: 0.9993 - val_loss: 2.4004 - val_acc: 0.7713
    Epoch 450/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0115 - acc: 0.9992    Epoch 00449: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0113 - acc: 0.9993 - val_loss: 2.3602 - val_acc: 0.7641
    Epoch 451/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00450: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3574 - val_acc: 0.7689
    Epoch 452/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00451: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3797 - val_acc: 0.7665
    Epoch 453/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00452: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3540 - val_acc: 0.7701
    Epoch 454/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00453: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3849 - val_acc: 0.7665
    Epoch 455/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00454: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3520 - val_acc: 0.7653
    Epoch 456/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00455: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3629 - val_acc: 0.7677
    Epoch 457/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00456: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2751 - val_acc: 0.7737
    Epoch 458/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00457: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3592 - val_acc: 0.7689
    Epoch 459/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00458: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2646 - val_acc: 0.7653
    Epoch 460/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00459: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2444 - val_acc: 0.7725
    Epoch 461/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00460: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2356 - val_acc: 0.7820
    Epoch 462/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00461: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2773 - val_acc: 0.7737
    Epoch 463/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0097 - acc: 0.9994    Epoch 00462: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3962 - val_acc: 0.7677
    Epoch 464/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00463: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4089 - val_acc: 0.7725
    Epoch 465/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00464: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3973 - val_acc: 0.7713
    Epoch 466/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00465: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4187 - val_acc: 0.7737
    Epoch 467/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00466: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4553 - val_acc: 0.7772
    Epoch 468/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00467: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4001 - val_acc: 0.7677
    Epoch 469/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00468: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4756 - val_acc: 0.7653
    Epoch 470/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00469: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4760 - val_acc: 0.7617
    Epoch 471/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992Epoch 00470: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4847 - val_acc: 0.7737
    Epoch 472/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00471: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4914 - val_acc: 0.7617
    Epoch 473/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00472: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4050 - val_acc: 0.7677
    Epoch 474/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00473: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3273 - val_acc: 0.7641
    Epoch 475/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00474: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4335 - val_acc: 0.7653
    Epoch 476/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00475: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4564 - val_acc: 0.7617
    Epoch 477/2000
    6520/6680 [============================>.] - ETA: 0s - loss: 0.0099 - acc: 0.9994    Epoch 00476: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0120 - acc: 0.9993 - val_loss: 2.4956 - val_acc: 0.7593
    Epoch 478/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0112 - acc: 0.9992    Epoch 00477: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0108 - acc: 0.9993 - val_loss: 2.4730 - val_acc: 0.7557
    Epoch 479/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00478: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4924 - val_acc: 0.7629
    Epoch 480/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00479: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4118 - val_acc: 0.7784
    Epoch 481/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00480: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4057 - val_acc: 0.7713
    Epoch 482/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00481: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4319 - val_acc: 0.7749
    Epoch 483/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00482: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4625 - val_acc: 0.7605
    Epoch 484/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00483: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4310 - val_acc: 0.7737
    Epoch 485/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00484: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4574 - val_acc: 0.7760
    Epoch 486/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00485: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4189 - val_acc: 0.7796
    Epoch 487/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00486: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0126 - acc: 0.9991 - val_loss: 2.3911 - val_acc: 0.7784
    Epoch 488/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00487: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3849 - val_acc: 0.7665
    Epoch 489/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0108 - acc: 0.9992    Epoch 00488: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0105 - acc: 0.9993 - val_loss: 2.3997 - val_acc: 0.7689
    Epoch 490/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0119 - acc: 0.9992    Epoch 00489: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0116 - acc: 0.9993 - val_loss: 2.4223 - val_acc: 0.7629
    Epoch 491/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0100 - acc: 0.9994    Epoch 00490: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4142 - val_acc: 0.7725
    Epoch 492/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00491: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4315 - val_acc: 0.7737
    Epoch 493/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0141 - acc: 0.9991    Epoch 00492: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0140 - acc: 0.9991 - val_loss: 2.5464 - val_acc: 0.7557
    Epoch 494/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0128 - acc: 0.9991    Epoch 00493: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0127 - acc: 0.9991 - val_loss: 2.3867 - val_acc: 0.7725
    Epoch 495/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00494: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3272 - val_acc: 0.7713
    Epoch 496/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00495: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3126 - val_acc: 0.7665
    Epoch 497/2000
    6460/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9992    Epoch 00496: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2746 - val_acc: 0.7665
    Epoch 498/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00497: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.2413 - val_acc: 0.7665
    Epoch 499/2000
    6660/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00498: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3087 - val_acc: 0.7820
    Epoch 500/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0097 - acc: 0.9994    Epoch 00499: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3223 - val_acc: 0.7772
    Epoch 501/2000
    6500/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00500: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3355 - val_acc: 0.7653
    Epoch 502/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9991    Epoch 00501: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0123 - acc: 0.9991 - val_loss: 2.3628 - val_acc: 0.7760
    Epoch 503/2000
    6540/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00502: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3143 - val_acc: 0.7725
    Epoch 504/2000
    6560/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00503: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3449 - val_acc: 0.7677
    Epoch 505/2000
    6620/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00504: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4124 - val_acc: 0.7725
    Epoch 506/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00505: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4261 - val_acc: 0.7749
    Epoch 507/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0124 - acc: 0.9992    Epoch 00506: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4062 - val_acc: 0.7760
    Epoch 508/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0098 - acc: 0.9994    Epoch 00507: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3871 - val_acc: 0.7641
    Epoch 509/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00508: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3850 - val_acc: 0.7665
    Epoch 510/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00509: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3373 - val_acc: 0.7713
    Epoch 511/2000
    6640/6680 [============================>.] - ETA: 0s - loss: 0.0121 - acc: 0.9992    Epoch 00510: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.3525 - val_acc: 0.7641
    Epoch 512/2000
    6600/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00511: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4942 - val_acc: 0.7593
    Epoch 513/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00512: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4551 - val_acc: 0.7605
    Epoch 514/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0125 - acc: 0.9991    Epoch 00513: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0123 - acc: 0.9991 - val_loss: 2.4337 - val_acc: 0.7665
    Epoch 515/2000
    6480/6680 [============================>.] - ETA: 0s - loss: 0.0133 - acc: 0.9991    Epoch 00514: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0129 - acc: 0.9991 - val_loss: 2.4464 - val_acc: 0.7605
    Epoch 516/2000
    6580/6680 [============================>.] - ETA: 0s - loss: 0.0122 - acc: 0.9992    Epoch 00515: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0121 - acc: 0.9993 - val_loss: 2.4382 - val_acc: 0.7677
    Epoch 517/2000
    6440/6680 [===========================>..] - ETA: 0s - loss: 0.0123 - acc: 0.9992    Epoch 00516: val_loss did not improve
    6680/6680 [==============================] - 1s - loss: 0.0119 - acc: 0.9993 - val_loss: 2.4589 - val_acc: 0.7725
    Epoch 518/2000
    2400/6680 [=========>....................] - ETA: 0s - loss: 0.0094 - acc: 0.9992    

I tried three times, it was working in my terminal but it was taking a lot of time through Jupyter. Anyways, It ended up working properly.

### (IMPLEMENTATION) Load the Model with the Best Validation Loss


```python
### Loads the model weights with the best validation loss.
Inc_model.load_weights('saved_models/weights.best.Inc_model.hdf5')
```

### (IMPLEMENTATION) Test the Model

Try out your model on the test dataset of dog images. Ensure that your test accuracy is greater than 60%.


```python
### Classification accuracy on the test dataset.
Inc_predictions = [np.argmax(Inc_model.predict(np.expand_dims(feature, axis=0))) for feature in test_Inception]

# report test accuracy
test_accuracy = 100*np.sum(np.array(Inc_predictions)==np.argmax(test_targets, axis=1))/len(Inc_predictions)
print('Test accuracy: %.4f%%' % test_accuracy)
```

    Test accuracy: 78.3493%


### (IMPLEMENTATION) Predict Dog Breed with the Model

Write a function that takes an image path as input and returns the dog breed (`Affenpinscher`, `Afghan_hound`, etc) that is predicted by your model.  

Similar to the analogous function in Step 5, your function should have three steps:
1. Extract the bottleneck features corresponding to the chosen CNN model.
2. Supply the bottleneck features as input to the model to return the predicted vector.  Note that the argmax of this prediction vector gives the index of the predicted dog breed.
3. Use the `dog_names` array defined in Step 0 of this notebook to return the corresponding breed.

The functions to extract the bottleneck features can be found in `extract_bottleneck_features.py`, and they have been imported in an earlier code cell.  To obtain the bottleneck features corresponding to your chosen CNN architecture, you need to use the function

    extract_{network}
    
where `{network}`, in the above filename, should be one of `VGG19`, `Resnet50`, `InceptionV3`, or `Xception`.


```python
### A function that takes a path to an image as input
### and returns the dog breed that is predicted by the model.
def Inc_predict_breed(img_path):
    # extract bottleneck features
    bottleneck_feature = extract_VGG16(path_to_tensor(img_path))
    # obtain predicted vector
    predicted_vector = Inc_model.predict(bottleneck_feature)
    # return dog breed that is predicted by the model
    return dog_names[np.argmax(predicted_vector)]
```

---
<a id='step6'></a>
## Step 6: Write your Algorithm

Write an algorithm that accepts a file path to an image and first determines whether the image contains a human, dog, or neither.  Then,
- if a __dog__ is detected in the image, return the predicted breed.
- if a __human__ is detected in the image, return the resembling dog breed.
- if __neither__ is detected in the image, provide output that indicates an error.

You are welcome to write your own functions for detecting humans and dogs in images, but feel free to use the `face_detector` and `dog_detector` functions developed above.  You are __required__ to use your CNN from Step 5 to predict dog breed.  

Some sample output for our algorithm is provided below, but feel free to design your own user experience!

![Sample Human Output](images/sample_human_output.png)


### (IMPLEMENTATION) Write your Algorithm


```python
def predict_breed_or_human_resemblance(img_path):
    animal = None
    message = None
    breed = None
    if dog_detector(img_path):
        animal = "dog"
        message = "your predicted breed is"
    
    if face_detector(img_path):
        animal = "human"
        message = "you look like a"
    
    if not animal:
        return "Neither a dog nor a human!!! Could be alien"
    
    breed = Inc_predict_breed(img_path)
    return "Hello, {}! {} ... {}".format(animal, message, breed)
```

---
<a id='step7'></a>
## Step 7: Test Your Algorithm

In this section, you will take your new algorithm for a spin!  What kind of dog does the algorithm think that __you__ look like?  If you have a dog, does it predict your dog's breed accurately?  If you have a cat, does it mistakenly think that your cat is a dog?

### (IMPLEMENTATION) Test Your Algorithm on Sample Images!

Test your algorithm at least six images on your computer.  Feel free to use any images you like.  Use at least two human and two dog images.  

__Question 6:__ Is the output better than you expected :) ?  Or worse :( ?  Provide at least three possible points of improvement for your algorithm.

__Answer:__ 


```python
print(predict_breed_or_human_resemblance("./dogImages/test/001.Affenpinscher/Affenpinscher_00003.jpg"))
print(predict_breed_or_human_resemblance("./dogImages/test/124.Poodle/Poodle_07923.jpg"))
print(predict_breed_or_human_resemblance("./TomWard.jpg"))
print(predict_breed_or_human_resemblance("./gameofthrones-dragon.jpg"))
print(predict_breed_or_human_resemblance("./emilia_clarke.jpeg"))
print(predict_breed_or_human_resemblance("./myphoto.jpg"))
print(predict_breed_or_human_resemblance("./CatPhoto.jpg"))
```

    Hello, dog! your predicted breed is ... Affenpinscher
    Hello, dog! your predicted breed is ... Poodle
    Hello, human! you look like a ... English_toy_spaniel
    Neither a dog nor a human!!! Could be alien
    Hello, human! you look like a ... Maltese
    Hello, human! you look like a ... Bichon_frise
    Neither a dog nor a human!!! Could be alien


I tried only 6 images, I got all correct answers 100% accuracy :) 
    
1. We can improve this by building more models and perform prediction on an ensemble model.
2. We can also improve it by storing the probabilities of a prediction (just before they get 'softmax') and determine dog-or-human based on highest probability of the classification.
